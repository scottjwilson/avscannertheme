(function(){function M(t,e){console.error(`[AVScanner] ${t}:`,e)}window.addEventListener("unhandledrejection",t=>{M("unhandled-promise",t.reason)});const R=window.matchMedia("(prefers-reduced-motion: reduce)").matches,w=document.querySelector(".site-header"),A=document.querySelector(".category-nav");function $(){window.scrollY>50?(w==null||w.classList.add("is-scrolled"),A==null||A.classList.add("is-scrolled")):(w==null||w.classList.remove("is-scrolled"),A==null||A.classList.remove("is-scrolled"))}const m=document.querySelector(".menu-toggle"),d=document.querySelector(".nav-mobile");function Y(){const t=(m==null?void 0:m.getAttribute("aria-expanded"))==="true";m==null||m.setAttribute("aria-expanded",!t),d==null||d.classList.toggle("is-open"),d==null||d.setAttribute("aria-hidden",t),document.body.classList.toggle("menu-open")}function C(){m==null||m.setAttribute("aria-expanded","false"),d==null||d.classList.remove("is-open"),d==null||d.setAttribute("aria-hidden","true"),document.body.classList.remove("menu-open")}function H(t){const e=t.getBoundingClientRect();return e.top<window.innerHeight&&e.bottom>0}function j(){const t=document.querySelectorAll(".reveal");if(!t.length)return;const e=new IntersectionObserver(s=>{s.forEach(o=>{o.isIntersecting&&o.target.classList.add("is-visible")})},{rootMargin:"0px 0px -10% 0px",threshold:.1});t.forEach(s=>{H(s)?s.classList.add("is-visible"):e.observe(s)})}function F(){const t=document.querySelectorAll(".stagger-children");if(!t.length)return;const e=new IntersectionObserver(s=>{s.forEach(o=>{o.isIntersecting&&o.target.classList.add("is-visible")})},{rootMargin:"0px 0px -10% 0px",threshold:.1});t.forEach(s=>{H(s)?s.classList.add("is-visible"):e.observe(s)})}function U(){document.querySelectorAll('a[href^="#"]').forEach(t=>{t.addEventListener("click",function(e){const s=this.getAttribute("href");if(s==="#")return;const o=document.querySelector(s);if(o){e.preventDefault();const a=(w==null?void 0:w.offsetHeight)||0,u=o.getBoundingClientRect().top+window.pageYOffset-a-20;window.scrollTo({top:u,behavior:"smooth"}),C()}})})}function B(){document.querySelectorAll(".card-image img, .single-image img").forEach(e=>{e.complete&&e.naturalHeight>0?e.classList.add("is-loaded"):(e.addEventListener("load",()=>e.classList.add("is-loaded"),{once:!0}),e.addEventListener("error",()=>e.classList.add("is-loaded"),{once:!0}))})}function V(){const t=document.querySelectorAll("[data-year]"),e=new Date().getFullYear();t.forEach(s=>{s.textContent=e})}function J(){const t=document.querySelector(".theme-toggle");if(!t)return;const e=localStorage.getItem("cvw-theme");(e==="light"||e==="dark")&&(document.documentElement.dataset.theme=e),t.addEventListener("click",()=>{const o=document.documentElement.dataset.theme==="light"?"dark":"light";document.documentElement.dataset.theme=o,localStorage.setItem("cvw-theme",o)})}function K(){const t=document.querySelector(".back-to-top");t&&(window.addEventListener("scroll",()=>{window.scrollY>400?(t.hidden=!1,requestAnimationFrame(()=>t.classList.add("is-visible"))):(t.classList.remove("is-visible"),t.addEventListener("transitionend",()=>{t.classList.contains("is-visible")||(t.hidden=!0)},{once:!0}))},{passive:!0}),t.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})}))}function z(t){const e=document.getElementById("card-skeleton");return e?Array.from({length:t},()=>{const s=e.content.cloneNode(!0).firstElementChild;return s.classList.add("infinite-scroll-skeleton"),s}):[]}function G(){const t=document.querySelectorAll("[data-infinite-scroll]");t.length&&t.forEach(e=>{const s=parseInt(e.dataset.perPage)||12,o=parseInt(e.dataset.totalPages)||1,a=e.dataset.category||"";let u=parseInt(e.dataset.currentPage)||1,f=!1;const l=e.nextElementSibling;if(!l)return;l.querySelector(".infinite-scroll-sentinel");const c=l.querySelector(".infinite-scroll-load-more"),r=l.querySelector(".infinite-scroll-status"),h=document.createElement("div");if(h.className="sr-only",h.setAttribute("aria-live","polite"),h.setAttribute("aria-atomic","true"),e.parentNode.insertBefore(h,e.nextSibling),u>=o)return;c.hidden=!1,c.addEventListener("click",b);async function b(){if(f||u>=o)return;f=!0,c.hidden=!0,r.hidden=!1,r.textContent="Loading more posts…";const E=z(3);e.append(...E);try{const L=new URLSearchParams({page:u+1,per_page:s});a&&L.set("category",a);const p=await fetch(`/wp-json/avscannertheme/v1/cards?${L}`);if(!p.ok)throw new Error(p.statusText);const x=await p.json(),q=parseInt(p.headers.get("X-WP-TotalPages"))||o;E.forEach(k=>k.remove()),x.cards.forEach(k=>{e.insertAdjacentHTML("beforeend",k)}),h.textContent=`Loaded ${x.cards.length} more posts`,u++,e.dataset.currentPage=u,u>=q?(c.hidden=!0,r.hidden=!1,r.textContent="All posts loaded"):(c.hidden=!1,r.hidden=!0),B()}catch(L){M("infinite-scroll",L),E.forEach(p=>p.remove()),c.hidden=!1,r.hidden=!1,r.textContent="Failed to load — try again"}f=!1}})}function D(t){const e=document.createElement("div");return e.textContent=t||"",e.innerHTML}function W(){const t=document.getElementById("header-search-input"),e=document.getElementById("search-dropdown");if(!t||!e)return;const s=document.querySelector(".search-overlay"),o=s==null?void 0:s.querySelector(".search-overlay-input"),a=s==null?void 0:s.querySelector(".search-overlay-results"),u=s==null?void 0:s.querySelector(".search-overlay-back"),f=document.querySelector(".search-trigger");window.matchMedia("(max-width: 639px)");let l=null,c=null,r=-1;function h(n,i){n.innerHTML=i}function b(n){e.innerHTML=n,e.hidden=!1,t.setAttribute("aria-expanded","true")}function E(){e.hidden=!0,e.innerHTML="",t.setAttribute("aria-expanded","false"),r=-1}function L(n){return n.querySelectorAll(".search-dropdown-item")}function p(n,i){const v=L(n);v.forEach(g=>g.classList.remove("is-active")),r=i,v[r]&&(v[r].classList.add("is-active"),v[r].scrollIntoView({block:"nearest"}))}function x(n,i,v){if(!n.length)return'<div class="search-dropdown-empty">No results found</div>';const g=n.map(y=>{var P;const T=y.thumbnail_url?`<img class="search-dropdown-thumb" src="${y.thumbnail_url}" alt="" loading="lazy" decoding="async">`:"",ee=(P=y.categories_detail)!=null&&P.length?`<span class="badge badge-${y.categories_detail[0].slug}">${D(y.categories_detail[0].name)}</span>`:"";return`<a class="search-dropdown-item" href="${y.permalink}" role="option" tabindex="-1">
            ${T}
            <span class="search-dropdown-body">
              <span class="search-dropdown-title">${D(y.title)}</span>
              <span class="search-dropdown-meta">${ee}<span>${D(y.date_short)}</span></span>
            </span>
          </a>`}).join(""),S=`<a class="search-dropdown-footer" href="${v}?s=${encodeURIComponent(i)}&post_type=fb_post" tabindex="-1">View all results →</a>`;return g+S}async function q(n,i,v){c&&c.abort(),c=new AbortController;const g=i===a;g?h(i,'<div class="search-dropdown-loading">Searching…</div>'):b('<div class="search-dropdown-loading">Searching…</div>');try{const S=await fetch(`/wp-json/avscanner/v1/posts?search=${encodeURIComponent(n)}&per_page=5`,{signal:c.signal});if(!S.ok)throw new Error(S.statusText);const y=await S.json(),T=x(y,n,v);g?h(i,T):b(T),r=-1}catch(S){if(S.name==="AbortError")return;M("inline-search",S),g?h(i,""):E()}}if(t.addEventListener("input",()=>{clearTimeout(l);const n=t.value.trim();if(n.length<2){E();return}const i=t.closest("form").action;l=setTimeout(()=>q(n,e,i),300)}),t.addEventListener("keydown",n=>{if(e.hidden)return;if(n.key==="Tab"){E();return}const i=L(e);i.length&&(n.key==="ArrowDown"?(n.preventDefault(),p(e,r<i.length-1?r+1:0)):n.key==="ArrowUp"?(n.preventDefault(),p(e,r>0?r-1:i.length-1)):n.key==="Enter"?r>=0&&i[r]&&(n.preventDefault(),i[r].click()):n.key==="Escape"&&(n.preventDefault(),E()))}),document.addEventListener("click",n=>{n.target.closest(".header-search-wrap")||E()}),t.addEventListener("focus",()=>{t.value.trim().length>=2&&e.innerHTML&&e.hidden&&(e.hidden=!1,t.setAttribute("aria-expanded","true"))}),!s||!o||!a||!u||!f)return;let k=0;function N(){k=window.scrollY,s.hidden=!1,document.body.classList.add("search-open"),document.body.style.top=`-${k}px`,o.focus();const n=o.value.trim();if(n.length>=2){const i=o.closest("form").action;q(n,a,i)}s.addEventListener("keydown",_)}function I(){s.hidden=!0,document.body.classList.remove("search-open"),document.body.style.top="",window.scrollTo(0,k),h(a,""),r=-1,s.removeEventListener("keydown",_),f.focus()}function _(n){if(n.key!=="Tab")return;const i=s.querySelectorAll('button, [href], input, [tabindex]:not([tabindex="-1"])');if(!i.length)return;const v=i[0],g=i[i.length-1];n.shiftKey?document.activeElement===v&&(n.preventDefault(),g.focus()):document.activeElement===g&&(n.preventDefault(),v.focus())}f.addEventListener("click",N),u.addEventListener("click",I),a.addEventListener("touchstart",()=>o.blur(),{passive:!0}),o.addEventListener("input",()=>{clearTimeout(l);const n=o.value.trim();if(n.length<2){h(a,"");return}const i=o.closest("form").action;l=setTimeout(()=>q(n,a,i),300)}),o.addEventListener("keydown",n=>{const i=L(a);if(n.key==="Escape"){n.preventDefault(),I();return}i.length&&(n.key==="ArrowDown"?(n.preventDefault(),p(a,r<i.length-1?r+1:0)):n.key==="ArrowUp"?(n.preventDefault(),p(a,r>0?r-1:i.length-1)):n.key==="Enter"&&r>=0&&i[r]&&(n.preventDefault(),i[r].click()))}),a.addEventListener("click",n=>{n.target.closest(".search-dropdown-item")&&I()}),document.addEventListener("keydown",n=>{n.key==="Escape"&&!s.hidden&&I()})}function X(){const t="avs_scroll_pos",e=document.querySelector("[data-infinite-scroll]");if(e){e.addEventListener("click",o=>{o.target.closest("a")&&sessionStorage.setItem(t,JSON.stringify({scrollY:window.scrollY}))});const s=sessionStorage.getItem(t);if(s){sessionStorage.removeItem(t);try{const{scrollY:o}=JSON.parse(s);o&&requestAnimationFrame(()=>window.scrollTo(0,o))}catch{}}}}function Q(){const t=!!navigator.share;document.querySelectorAll(".share-btn-native").forEach(e=>{var s;t&&(e.hidden=!1,(s=e.nextElementSibling)==null||s.classList.add("share-buttons-hidden"),e.addEventListener("click",async()=>{try{await navigator.share({title:e.dataset.shareTitle,url:e.dataset.shareUrl})}catch{}}))}),document.querySelectorAll(".copy-link-btn").forEach(e=>{e.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(e.dataset.url||location.href),e.classList.add("is-copied"),setTimeout(()=>e.classList.remove("is-copied"),2e3)}catch{}})})}function Z(){const t=document.getElementById("codes-search-input");if(!t)return;const e=document.querySelectorAll(".codes-section"),s=document.querySelectorAll(".codes-row"),o=document.getElementById("codes-match-count"),a=document.getElementById("codes-empty"),u=document.querySelectorAll(".codes-nav-tab");t.addEventListener("input",()=>{const f=t.value.trim().toLowerCase();if(!f){s.forEach(c=>c.hidden=!1),e.forEach(c=>c.classList.remove("is-hidden")),o&&(o.hidden=!0),a&&(a.hidden=!0);return}let l=0;s.forEach(c=>{const r=c.dataset.code||"",h=c.dataset.desc||"",b=r.includes(f)||h.includes(f);c.hidden=!b,b&&l++}),e.forEach(c=>{const r=c.querySelectorAll(".codes-row:not([hidden])");c.classList.toggle("is-hidden",r.length===0)}),o&&(o.textContent=`${l} result${l!==1?"s":""}`,o.hidden=!1),a&&(a.hidden=l>0)}),u.forEach(f=>{f.addEventListener("click",()=>{t.value="",t.dispatchEvent(new Event("input")),u.forEach(l=>l.classList.remove("is-active")),f.classList.add("is-active")})})}function O(){window.addEventListener("scroll",$,{passive:!0}),m==null||m.addEventListener("click",Y),d==null||d.querySelectorAll(".nav-link").forEach(t=>{t.addEventListener("click",C)}),document.addEventListener("keydown",t=>{t.key==="Escape"&&C()}),$(),J(),R||(j(),F(),U()),W(),X(),G(),B(),V(),K(),Q(),Z()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",O):O()})();
