(function(){const M=window.matchMedia("(prefers-reduced-motion: reduce)").matches,p=document.querySelector(".site-header"),L=document.querySelector(".category-nav");function I(){window.scrollY>50?(p==null||p.classList.add("is-scrolled"),L==null||L.classList.add("is-scrolled")):(p==null||p.classList.remove("is-scrolled"),L==null||L.classList.remove("is-scrolled"))}const h=document.querySelector(".menu-toggle"),d=document.querySelector(".nav-mobile");function q(){const e=(h==null?void 0:h.getAttribute("aria-expanded"))==="true";h==null||h.setAttribute("aria-expanded",!e),d==null||d.classList.toggle("is-open"),d==null||d.setAttribute("aria-hidden",e),document.body.classList.toggle("menu-open")}function k(){h==null||h.setAttribute("aria-expanded","false"),d==null||d.classList.remove("is-open"),d==null||d.setAttribute("aria-hidden","true"),document.body.classList.remove("menu-open")}function T(){const e=document.querySelectorAll(".reveal");if(!e.length)return;const t={root:null,rootMargin:"0px 0px -10% 0px",threshold:.1},r=new IntersectionObserver(s=>{s.forEach(o=>{o.isIntersecting&&o.target.classList.add("is-visible")})},t);e.forEach(s=>{r.observe(s)})}function C(){const e=document.querySelectorAll(".stagger-children");if(!e.length)return;const t={root:null,rootMargin:"0px 0px -10% 0px",threshold:.1},r=new IntersectionObserver(s=>{s.forEach(o=>{o.isIntersecting&&o.target.classList.add("is-visible")})},t);e.forEach(s=>{r.observe(s)})}function H(){document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){const r=this.getAttribute("href");if(r==="#")return;const s=document.querySelector(r);if(s){t.preventDefault();const o=(p==null?void 0:p.offsetHeight)||0,a=s.getBoundingClientRect().top+window.pageYOffset-o-20;window.scrollTo({top:a,behavior:"smooth"}),k()}})})}function x(){document.querySelectorAll(".card-image img, .single-image img").forEach(t=>{t.complete&&t.naturalHeight>0?t.classList.add("is-loaded"):(t.addEventListener("load",()=>t.classList.add("is-loaded"),{once:!0}),t.addEventListener("error",()=>t.classList.add("is-loaded"),{once:!0}))})}function O(){const e=document.querySelectorAll("[data-year]"),t=new Date().getFullYear();e.forEach(r=>{r.textContent=t})}function P(){const e=document.querySelector(".theme-toggle");if(!e)return;const t=localStorage.getItem("cvw-theme");(t==="light"||t==="dark")&&(document.documentElement.dataset.theme=t),e.addEventListener("click",()=>{const s=document.documentElement.dataset.theme==="light"?"dark":"light";document.documentElement.dataset.theme=s,localStorage.setItem("cvw-theme",s)})}function R(){const e=document.querySelector(".back-to-top");e&&(window.addEventListener("scroll",()=>{window.scrollY>400?(e.hidden=!1,requestAnimationFrame(()=>e.classList.add("is-visible"))):(e.classList.remove("is-visible"),e.addEventListener("transitionend",()=>{e.classList.contains("is-visible")||(e.hidden=!0)},{once:!0}))},{passive:!0}),e.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})}))}function B(){const e=document.querySelectorAll(".grid.stagger-children"),t=document.getElementById("card-skeleton");!e.length||!t||e.forEach(r=>{const s=r.querySelectorAll(".card");if(!s.length)return;const o=Math.min(s.length,6),a=document.createElement("div");a.className="skeleton-grid",a.classList.add("grid","grid-3");for(let n=0;n<o;n++)a.appendChild(t.content.cloneNode(!0));r.parentNode.insertBefore(a,r),r.style.display="none";const l=r.querySelectorAll(".card-image img");if(!l.length){A(a,r);return}let f=0;const c=l.length;function u(){f++,f>=c&&A(a,r)}l.forEach(n=>{n.complete&&n.naturalHeight>0?u():(n.addEventListener("load",u,{once:!0}),n.addEventListener("error",u,{once:!0}))}),setTimeout(()=>A(a,r),5e3)})}function A(e,t){e.parentNode&&(e.classList.add("skeleton-fade-out"),t.style.display="",e.addEventListener("transitionend",()=>{e.remove()},{once:!0}),setTimeout(()=>e.remove(),400))}function m(e){const t=document.createElement("div");return t.textContent=e||"",t.innerHTML}function D(e){const t=document.getElementById("card-skeleton");return t?Array.from({length:e},()=>{const r=t.content.cloneNode(!0).firstElementChild;return r.classList.add("infinite-scroll-skeleton"),r}):[]}function Y(e){var l,f;const t=document.createElement("article"),r=(l=e.categories_detail)==null?void 0:l.some(c=>c.slug==="advertisement");t.className="card card-hover"+(r?" card-sponsored":"");let s="";if(e.thumbnail_url||e.thumbnail_html){const c=e.video_url?" has-video":"",u=e.video_url?'<span class="card-play-icon" aria-hidden="true"><svg width="48" height="48" viewBox="0 0 48 48" fill="none"><circle cx="24" cy="24" r="24" fill="rgba(0,0,0,0.6)"/><path d="M19 15l14 9-14 9V15z" fill="white"/></svg></span>':"",n=e.thumbnail_html?e.thumbnail_html:`<img src="${e.thumbnail_url}" alt="${m(e.title)}" loading="lazy" decoding="async">`;s=`<a href="${e.permalink}" class="card-image-link${c}"><div class="card-image">${n}${u}</div></a>`}let o="";(f=e.categories_detail)!=null&&f.length&&(r?o='<div class="card-badges"><span class="badge badge-sponsored">Sponsored</span></div>':o='<div class="card-badges">'+e.categories_detail.map(c=>`<a href="${c.link}" class="badge badge-${c.slug}">${m(c.name)}</a>`).join("")+"</div>");let a="";if(e.shared_url)try{const c=new URL(e.shared_url).hostname;a=`<span class="card-source">via ${m(c)}</span>`}catch{}return t.innerHTML=`
        ${s}
        <span class="card-date">${m(e.date_short)} at ${m(e.time)}</span>
        ${o}
        ${a}
        <h3 class="card-title"><a href="${e.permalink}">${m(e.title)}</a></h3>
        <p class="card-text">${m(e.excerpt_short)}</p>
        <a href="${e.permalink}" class="card-link">Read more <svg width="16" height="16" viewBox="0 0 20 20" fill="none"><path d="M4.167 10h11.666M10 4.167L15.833 10 10 15.833" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></a>
    `,t}function j(){const e=document.querySelectorAll("[data-infinite-scroll]");e.length&&e.forEach(t=>{const r=parseInt(t.dataset.perPage)||12,s=parseInt(t.dataset.totalPages)||1,o=t.dataset.category||"";let a=parseInt(t.dataset.currentPage)||1,l=!1;const f=t.nextElementSibling;if(!f)return;const c=f.querySelector(".infinite-scroll-sentinel"),u=f.querySelector(".infinite-scroll-load-more"),n=f.querySelector(".infinite-scroll-status");if(a>=s)return;const i=new IntersectionObserver(y=>{y[0].isIntersecting&&!l&&w()},{rootMargin:"200px"});i.observe(c),u.hidden=!1,u.addEventListener("click",w);async function w(){if(l||a>=s)return;l=!0,u.hidden=!0,n.hidden=!1,n.textContent="Loading more posts…";const y=D(3);t.append(...y);try{const b=new URLSearchParams({page:a+1,per_page:r});o&&b.set("category",o);const v=await fetch(`/wp-json/avscanner/v1/posts?${b}`);if(!v.ok)throw new Error(v.statusText);const g=await v.json(),$=parseInt(v.headers.get("X-WP-TotalPages"))||s;y.forEach(E=>E.remove()),g.forEach(E=>{const S=Y(E);t.appendChild(S)}),a++,t.dataset.currentPage=a,a>=$?(i.disconnect(),u.hidden=!0,n.hidden=!1,n.textContent="All posts loaded"):(u.hidden=!1,n.hidden=!0),x()}catch{y.forEach(v=>v.remove()),u.hidden=!1,n.hidden=!1,n.textContent="Failed to load — try again"}l=!1}})}function F(){const e=document.getElementById("header-search-input"),t=document.getElementById("search-dropdown");if(!e||!t)return;let r=null,s=null,o=-1;function a(n){t.innerHTML=n,t.hidden=!1,e.setAttribute("aria-expanded","true")}function l(){t.hidden=!0,t.innerHTML="",e.setAttribute("aria-expanded","false"),o=-1}function f(){return t.querySelectorAll(".search-dropdown-item")}function c(n){const i=f();i.forEach(w=>w.classList.remove("is-active")),o=n,i[o]&&(i[o].classList.add("is-active"),i[o].scrollIntoView({block:"nearest"}))}async function u(n){s&&s.abort(),s=new AbortController,a('<div class="search-dropdown-loading">Searching…</div>');try{const i=await fetch(`/wp-json/avscanner/v1/posts?search=${encodeURIComponent(n)}&per_page=5`,{signal:s.signal});if(!i.ok)throw new Error(i.statusText);const w=await i.json();if(!w.length){a('<div class="search-dropdown-empty">No results found</div>');return}const y=w.map(g=>{var S;const $=g.thumbnail_url?`<img class="search-dropdown-thumb" src="${g.thumbnail_url}" alt="" loading="lazy" decoding="async">`:"",E=(S=g.categories_detail)!=null&&S.length?`<span class="badge badge-${g.categories_detail[0].slug}">${m(g.categories_detail[0].name)}</span>`:"";return`<a class="search-dropdown-item" href="${g.permalink}" role="option">
              ${$}
              <span class="search-dropdown-body">
                <span class="search-dropdown-title">${m(g.title)}</span>
                <span class="search-dropdown-meta">${E}<span>${m(g.date_short)}</span></span>
              </span>
            </a>`}).join(""),v=`<a class="search-dropdown-footer" href="${e.closest("form").action}?s=${encodeURIComponent(n)}&post_type=fb_post">View all results →</a>`;a(y+v),o=-1}catch(i){if(i.name==="AbortError")return;l()}}e.addEventListener("input",()=>{clearTimeout(r);const n=e.value.trim();if(n.length<2){l();return}r=setTimeout(()=>u(n),300)}),e.addEventListener("keydown",n=>{if(t.hidden)return;const i=f();i.length&&(n.key==="ArrowDown"?(n.preventDefault(),c(o<i.length-1?o+1:0)):n.key==="ArrowUp"?(n.preventDefault(),c(o>0?o-1:i.length-1)):n.key==="Enter"?o>=0&&i[o]&&(n.preventDefault(),i[o].click()):n.key==="Escape"&&(n.preventDefault(),l()))}),document.addEventListener("click",n=>{n.target.closest(".header-search-wrap")||l()}),e.addEventListener("focus",()=>{e.value.trim().length>=2&&t.innerHTML&&t.hidden&&(t.hidden=!1,e.setAttribute("aria-expanded","true"))})}function U(){const e="avs_scroll_pos",t=document.querySelector("[data-infinite-scroll]");if(t){t.addEventListener("click",s=>{s.target.closest("a")&&sessionStorage.setItem(e,JSON.stringify({scrollY:window.scrollY}))});const r=sessionStorage.getItem(e);if(r){sessionStorage.removeItem(e);try{const{scrollY:s}=JSON.parse(r);s&&requestAnimationFrame(()=>window.scrollTo(0,s))}catch{}}}}function _(){window.addEventListener("scroll",I,{passive:!0}),h==null||h.addEventListener("click",q),d==null||d.querySelectorAll(".nav-link").forEach(e=>{e.addEventListener("click",k)}),document.addEventListener("keydown",e=>{e.key==="Escape"&&k()}),I(),P(),M||(B(),T(),C(),H()),F(),U(),j(),x(),O(),R()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",_):_()})();
