(function(){function k(e,t){console.error(`[AVScanner] ${e}:`,t)}window.addEventListener("unhandledrejection",e=>{k("unhandled-promise",e.reason)});const q=window.matchMedia("(prefers-reduced-motion: reduce)").matches,p=document.querySelector(".site-header"),E=document.querySelector(".category-nav");function x(){window.scrollY>50?(p==null||p.classList.add("is-scrolled"),E==null||E.classList.add("is-scrolled")):(p==null||p.classList.remove("is-scrolled"),E==null||E.classList.remove("is-scrolled"))}const h=document.querySelector(".menu-toggle"),d=document.querySelector(".nav-mobile");function T(){const e=(h==null?void 0:h.getAttribute("aria-expanded"))==="true";h==null||h.setAttribute("aria-expanded",!e),d==null||d.classList.toggle("is-open"),d==null||d.setAttribute("aria-hidden",e),document.body.classList.toggle("menu-open")}function A(){h==null||h.setAttribute("aria-expanded","false"),d==null||d.classList.remove("is-open"),d==null||d.setAttribute("aria-hidden","true"),document.body.classList.remove("menu-open")}function C(){const e=document.querySelectorAll(".reveal");if(!e.length)return;const t={root:null,rootMargin:"0px 0px -10% 0px",threshold:.1},s=new IntersectionObserver(r=>{r.forEach(o=>{o.isIntersecting&&o.target.classList.add("is-visible")})},t);e.forEach(r=>{s.observe(r)})}function H(){const e=document.querySelectorAll(".stagger-children");if(!e.length)return;const t={root:null,rootMargin:"0px 0px -10% 0px",threshold:.1},s=new IntersectionObserver(r=>{r.forEach(o=>{o.isIntersecting&&o.target.classList.add("is-visible")})},t);e.forEach(r=>{s.observe(r)})}function O(){document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){const s=this.getAttribute("href");if(s==="#")return;const r=document.querySelector(s);if(r){t.preventDefault();const o=(p==null?void 0:p.offsetHeight)||0,a=r.getBoundingClientRect().top+window.pageYOffset-o-20;window.scrollTo({top:a,behavior:"smooth"}),A()}})})}function _(){document.querySelectorAll(".card-image img, .single-image img").forEach(t=>{t.complete&&t.naturalHeight>0?t.classList.add("is-loaded"):(t.addEventListener("load",()=>t.classList.add("is-loaded"),{once:!0}),t.addEventListener("error",()=>t.classList.add("is-loaded"),{once:!0}))})}function P(){const e=document.querySelectorAll("[data-year]"),t=new Date().getFullYear();e.forEach(s=>{s.textContent=t})}function R(){const e=document.querySelector(".theme-toggle");if(!e)return;const t=localStorage.getItem("cvw-theme");(t==="light"||t==="dark")&&(document.documentElement.dataset.theme=t),e.addEventListener("click",()=>{const r=document.documentElement.dataset.theme==="light"?"dark":"light";document.documentElement.dataset.theme=r,localStorage.setItem("cvw-theme",r)})}function B(){const e=document.querySelector(".back-to-top");e&&(window.addEventListener("scroll",()=>{window.scrollY>400?(e.hidden=!1,requestAnimationFrame(()=>e.classList.add("is-visible"))):(e.classList.remove("is-visible"),e.addEventListener("transitionend",()=>{e.classList.contains("is-visible")||(e.hidden=!0)},{once:!0}))},{passive:!0}),e.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})}))}function D(){const e=document.querySelectorAll(".grid.stagger-children"),t=document.getElementById("card-skeleton");!e.length||!t||e.forEach(s=>{const r=s.querySelectorAll(".card");if(!r.length)return;const o=Math.min(r.length,6),a=document.createElement("div");a.className="skeleton-grid",a.classList.add("grid","grid-3");for(let n=0;n<o;n++)a.appendChild(t.content.cloneNode(!0));s.parentNode.insertBefore(a,s),s.style.display="none";const l=s.querySelectorAll(".card-image img");if(!l.length){$(a,s);return}let f=0;const c=l.length;function u(){f++,f>=c&&$(a,s)}l.forEach(n=>{n.complete&&n.naturalHeight>0?u():(n.addEventListener("load",u,{once:!0}),n.addEventListener("error",u,{once:!0}))}),setTimeout(()=>$(a,s),5e3)})}function $(e,t){e.parentNode&&(e.classList.add("skeleton-fade-out"),t.style.display="",e.addEventListener("transitionend",()=>{e.remove()},{once:!0}),setTimeout(()=>e.remove(),400))}function m(e){const t=document.createElement("div");return t.textContent=e||"",t.innerHTML}function Y(e){const t=document.getElementById("card-skeleton");return t?Array.from({length:e},()=>{const s=t.content.cloneNode(!0).firstElementChild;return s.classList.add("infinite-scroll-skeleton"),s}):[]}function j(e){var l,f;const t=document.createElement("article"),s=(l=e.categories_detail)==null?void 0:l.some(c=>c.slug==="advertisement");t.className="card card-hover"+(s?" card-sponsored":"");let r="";if(e.thumbnail_url||e.thumbnail_html){const c=e.video_url?" has-video":"",u=e.video_url?'<span class="card-play-icon" aria-hidden="true"><svg width="48" height="48" viewBox="0 0 48 48" fill="none"><circle cx="24" cy="24" r="24" fill="rgba(0,0,0,0.6)"/><path d="M19 15l14 9-14 9V15z" fill="white"/></svg></span>':"",n=e.thumbnail_html?e.thumbnail_html:`<img src="${e.thumbnail_url}" alt="${m(e.title)}" loading="lazy" decoding="async">`;r=`<a href="${e.permalink}" class="card-image-link${c}"><div class="card-image">${n}${u}</div></a>`}let o="";(f=e.categories_detail)!=null&&f.length&&(s?o='<div class="card-badges"><span class="badge badge-sponsored">Sponsored</span></div>':o='<div class="card-badges">'+e.categories_detail.map(c=>`<a href="${c.link}" class="badge badge-${c.slug}">${m(c.name)}</a>`).join("")+"</div>");let a="";if(e.shared_url)try{const c=new URL(e.shared_url).hostname;a=`<span class="card-source">via ${m(c)}</span>`}catch{}return t.innerHTML=`
        ${r}
        <span class="card-date">${m(e.date_short)} at ${m(e.time)}</span>
        ${o}
        ${a}
        <h3 class="card-title"><a href="${e.permalink}">${m(e.title)}</a></h3>
        <p class="card-text">${m(e.excerpt_short)}</p>
        <a href="${e.permalink}" class="card-link">Read more <svg width="16" height="16" viewBox="0 0 20 20" fill="none"><path d="M4.167 10h11.666M10 4.167L15.833 10 10 15.833" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></a>
    `,t}function F(){const e=document.querySelectorAll("[data-infinite-scroll]");e.length&&e.forEach(t=>{const s=parseInt(t.dataset.perPage)||12,r=parseInt(t.dataset.totalPages)||1,o=t.dataset.category||"";let a=parseInt(t.dataset.currentPage)||1,l=!1;const f=t.nextElementSibling;if(!f)return;const c=f.querySelector(".infinite-scroll-sentinel"),u=f.querySelector(".infinite-scroll-load-more"),n=f.querySelector(".infinite-scroll-status");if(a>=r)return;const i=new IntersectionObserver(y=>{y[0].isIntersecting&&!l&&w()},{rootMargin:"200px"});i.observe(c),u.hidden=!1,u.addEventListener("click",w);async function w(){if(l||a>=r)return;l=!0,u.hidden=!0,n.hidden=!1,n.textContent="Loading more posts…";const y=Y(3);t.append(...y);try{const L=new URLSearchParams({page:a+1,per_page:s});o&&L.set("category",o);const v=await fetch(`/wp-json/avscanner/v1/posts?${L}`);if(!v.ok)throw new Error(v.statusText);const g=await v.json(),I=parseInt(v.headers.get("X-WP-TotalPages"))||r;y.forEach(b=>b.remove()),g.forEach(b=>{const S=j(b);t.appendChild(S)}),a++,t.dataset.currentPage=a,a>=I?(i.disconnect(),u.hidden=!0,n.hidden=!1,n.textContent="All posts loaded"):(u.hidden=!1,n.hidden=!0),_()}catch(L){k("infinite-scroll",L),y.forEach(v=>v.remove()),u.hidden=!1,n.hidden=!1,n.textContent="Failed to load — try again"}l=!1}})}function U(){const e=document.getElementById("header-search-input"),t=document.getElementById("search-dropdown");if(!e||!t)return;let s=null,r=null,o=-1;function a(n){t.innerHTML=n,t.hidden=!1,e.setAttribute("aria-expanded","true")}function l(){t.hidden=!0,t.innerHTML="",e.setAttribute("aria-expanded","false"),o=-1}function f(){return t.querySelectorAll(".search-dropdown-item")}function c(n){const i=f();i.forEach(w=>w.classList.remove("is-active")),o=n,i[o]&&(i[o].classList.add("is-active"),i[o].scrollIntoView({block:"nearest"}))}async function u(n){r&&r.abort(),r=new AbortController,a('<div class="search-dropdown-loading">Searching…</div>');try{const i=await fetch(`/wp-json/avscanner/v1/posts?search=${encodeURIComponent(n)}&per_page=5`,{signal:r.signal});if(!i.ok)throw new Error(i.statusText);const w=await i.json();if(!w.length){a('<div class="search-dropdown-empty">No results found</div>');return}const y=w.map(g=>{var S;const I=g.thumbnail_url?`<img class="search-dropdown-thumb" src="${g.thumbnail_url}" alt="" loading="lazy" decoding="async">`:"",b=(S=g.categories_detail)!=null&&S.length?`<span class="badge badge-${g.categories_detail[0].slug}">${m(g.categories_detail[0].name)}</span>`:"";return`<a class="search-dropdown-item" href="${g.permalink}" role="option">
              ${I}
              <span class="search-dropdown-body">
                <span class="search-dropdown-title">${m(g.title)}</span>
                <span class="search-dropdown-meta">${b}<span>${m(g.date_short)}</span></span>
              </span>
            </a>`}).join(""),v=`<a class="search-dropdown-footer" href="${e.closest("form").action}?s=${encodeURIComponent(n)}&post_type=fb_post">View all results →</a>`;a(y+v),o=-1}catch(i){if(i.name==="AbortError")return;k("inline-search",i),l()}}e.addEventListener("input",()=>{clearTimeout(s);const n=e.value.trim();if(n.length<2){l();return}s=setTimeout(()=>u(n),300)}),e.addEventListener("keydown",n=>{if(t.hidden)return;const i=f();i.length&&(n.key==="ArrowDown"?(n.preventDefault(),c(o<i.length-1?o+1:0)):n.key==="ArrowUp"?(n.preventDefault(),c(o>0?o-1:i.length-1)):n.key==="Enter"?o>=0&&i[o]&&(n.preventDefault(),i[o].click()):n.key==="Escape"&&(n.preventDefault(),l()))}),document.addEventListener("click",n=>{n.target.closest(".header-search-wrap")||l()}),e.addEventListener("focus",()=>{e.value.trim().length>=2&&t.innerHTML&&t.hidden&&(t.hidden=!1,e.setAttribute("aria-expanded","true"))})}function V(){const e="avs_scroll_pos",t=document.querySelector("[data-infinite-scroll]");if(t){t.addEventListener("click",r=>{r.target.closest("a")&&sessionStorage.setItem(e,JSON.stringify({scrollY:window.scrollY}))});const s=sessionStorage.getItem(e);if(s){sessionStorage.removeItem(e);try{const{scrollY:r}=JSON.parse(s);r&&requestAnimationFrame(()=>window.scrollTo(0,r))}catch{}}}}function M(){window.addEventListener("scroll",x,{passive:!0}),h==null||h.addEventListener("click",T),d==null||d.querySelectorAll(".nav-link").forEach(e=>{e.addEventListener("click",A)}),document.addEventListener("keydown",e=>{e.key==="Escape"&&A()}),x(),R(),q||(D(),C(),H(),O()),U(),V(),F(),_(),P(),B()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",M):M()})();
