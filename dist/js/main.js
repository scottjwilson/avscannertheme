(function(){function M(t,e){console.error(`[AVScanner] ${t}:`,e)}window.addEventListener("unhandledrejection",t=>{M("unhandled-promise",t.reason)});const B=window.matchMedia("(prefers-reduced-motion: reduce)").matches,g=document.querySelector(".site-header"),k=document.querySelector(".category-nav");function $(){window.scrollY>50?(g==null||g.classList.add("is-scrolled"),k==null||k.classList.add("is-scrolled")):(g==null||g.classList.remove("is-scrolled"),k==null||k.classList.remove("is-scrolled"))}const d=document.querySelector(".menu-toggle"),a=document.querySelector(".nav-mobile");function j(){const t=(d==null?void 0:d.getAttribute("aria-expanded"))==="true";d==null||d.setAttribute("aria-expanded",!t),a==null||a.classList.toggle("is-open"),a==null||a.setAttribute("aria-hidden",t),document.body.classList.toggle("menu-open")}function D(){d==null||d.setAttribute("aria-expanded","false"),a==null||a.classList.remove("is-open"),a==null||a.setAttribute("aria-hidden","true"),document.body.classList.remove("menu-open")}function O(t){const e=t.getBoundingClientRect();return e.top<window.innerHeight&&e.bottom>0}function F(){const t=document.querySelectorAll(".reveal");if(!t.length)return;const e=new IntersectionObserver(s=>{s.forEach(o=>{o.isIntersecting&&o.target.classList.add("is-visible")})},{rootMargin:"0px 0px -10% 0px",threshold:.1});t.forEach(s=>{O(s)?s.classList.add("is-visible"):e.observe(s)})}function U(){const t=document.querySelectorAll(".stagger-children");if(!t.length)return;const e=new IntersectionObserver(s=>{s.forEach(o=>{o.isIntersecting&&o.target.classList.add("is-visible")})},{rootMargin:"0px 0px -10% 0px",threshold:.1});t.forEach(s=>{O(s)?s.classList.add("is-visible"):e.observe(s)})}function V(){document.querySelectorAll('a[href^="#"]').forEach(t=>{t.addEventListener("click",function(e){const s=this.getAttribute("href");if(s==="#")return;const o=document.querySelector(s);if(o){e.preventDefault();const c=(g==null?void 0:g.offsetHeight)||0,u=o.getBoundingClientRect().top+window.pageYOffset-c-20;window.scrollTo({top:u,behavior:"smooth"}),D()}})})}function _(){document.querySelectorAll(".card-image img, .single-image img").forEach(e=>{e.complete&&e.naturalHeight>0?e.classList.add("is-loaded"):(e.addEventListener("load",()=>e.classList.add("is-loaded"),{once:!0}),e.addEventListener("error",()=>e.classList.add("is-loaded"),{once:!0}))})}function J(){const t=document.querySelectorAll("[data-year]"),e=new Date().getFullYear();t.forEach(s=>{s.textContent=e})}function K(){const t=document.querySelector(".theme-toggle");if(!t)return;const e=localStorage.getItem("cvw-theme");(e==="light"||e==="dark")&&(document.documentElement.dataset.theme=e),t.addEventListener("click",()=>{const o=document.documentElement.dataset.theme==="light"?"dark":"light";document.documentElement.dataset.theme=o,localStorage.setItem("cvw-theme",o)})}function z(){const t=document.querySelector(".back-to-top");t&&(window.addEventListener("scroll",()=>{window.scrollY>400?(t.hidden=!1,requestAnimationFrame(()=>t.classList.add("is-visible"))):(t.classList.remove("is-visible"),t.addEventListener("transitionend",()=>{t.classList.contains("is-visible")||(t.hidden=!0)},{once:!0}))},{passive:!0}),t.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})}))}function G(t){const e=document.getElementById("card-skeleton");return e?Array.from({length:t},()=>{const s=e.content.cloneNode(!0).firstElementChild;return s.classList.add("infinite-scroll-skeleton"),s}):[]}function W(){const t=document.querySelectorAll("[data-infinite-scroll]");t.length&&t.forEach(e=>{const s=parseInt(e.dataset.perPage)||12,o=parseInt(e.dataset.totalPages)||1,c=e.dataset.category||"";let u=parseInt(e.dataset.currentPage)||1,y=!1;const w=e.nextElementSibling;if(!w)return;const A=w.querySelector(".infinite-scroll-sentinel"),i=w.querySelector(".infinite-scroll-load-more"),l=w.querySelector(".infinite-scroll-status"),E=document.createElement("div");if(E.className="sr-only",E.setAttribute("aria-live","polite"),E.setAttribute("aria-atomic","true"),e.parentNode.insertBefore(E,e.nextSibling),u>=o)return;const S=new IntersectionObserver(h=>{h[0].isIntersecting&&!y&&x()},{rootMargin:"200px"});S.observe(A),i.hidden=!1,i.addEventListener("click",x);async function x(){if(y||u>=o)return;y=!0,i.hidden=!0,l.hidden=!1,l.textContent="Loading more posts…";const h=G(3);e.append(...h);try{const q=new URLSearchParams({page:u+1,per_page:s});c&&q.set("category",c);const m=await fetch(`/wp-json/avscannertheme/v1/cards?${q}`);if(!m.ok)throw new Error(m.statusText);const I=await m.json(),H=parseInt(m.headers.get("X-WP-TotalPages"))||o;h.forEach(L=>L.remove()),I.cards.forEach(L=>{e.insertAdjacentHTML("beforeend",L)}),E.textContent=`Loaded ${I.cards.length} more posts`,u++,e.dataset.currentPage=u,u>=H?(S.disconnect(),i.hidden=!0,l.hidden=!1,l.textContent="All posts loaded"):(i.hidden=!1,l.hidden=!0),_()}catch(q){M("infinite-scroll",q),h.forEach(m=>m.remove()),i.hidden=!1,l.hidden=!1,l.textContent="Failed to load — try again"}y=!1}})}function C(t){const e=document.createElement("div");return e.textContent=t||"",e.innerHTML}function X(){const t=document.getElementById("header-search-input"),e=document.getElementById("search-dropdown");if(!t||!e)return;const s=document.querySelector(".search-overlay"),o=s==null?void 0:s.querySelector(".search-overlay-input"),c=s==null?void 0:s.querySelector(".search-overlay-results"),u=s==null?void 0:s.querySelector(".search-overlay-back"),y=document.querySelector(".search-trigger");window.matchMedia("(max-width: 639px)");let w=null,A=null,i=-1;function l(n,r){n.innerHTML=r}function E(n){e.innerHTML=n,e.hidden=!1,t.setAttribute("aria-expanded","true")}function S(){e.hidden=!0,e.innerHTML="",t.setAttribute("aria-expanded","false"),i=-1}function x(n){return n.querySelectorAll(".search-dropdown-item")}function h(n,r){const f=x(n);f.forEach(p=>p.classList.remove("is-active")),i=r,f[i]&&(f[i].classList.add("is-active"),f[i].scrollIntoView({block:"nearest"}))}function q(n,r,f){if(!n.length)return'<div class="search-dropdown-empty">No results found</div>';const p=n.map(v=>{var Y;const T=v.thumbnail_url?`<img class="search-dropdown-thumb" src="${v.thumbnail_url}" alt="" loading="lazy" decoding="async">`:"",Z=(Y=v.categories_detail)!=null&&Y.length?`<span class="badge badge-${v.categories_detail[0].slug}">${C(v.categories_detail[0].name)}</span>`:"";return`<a class="search-dropdown-item" href="${v.permalink}" role="option">
            ${T}
            <span class="search-dropdown-body">
              <span class="search-dropdown-title">${C(v.title)}</span>
              <span class="search-dropdown-meta">${Z}<span>${C(v.date_short)}</span></span>
            </span>
          </a>`}).join(""),b=`<a class="search-dropdown-footer" href="${f}?s=${encodeURIComponent(r)}&post_type=fb_post">View all results →</a>`;return p+b}async function m(n,r,f){A&&A.abort(),A=new AbortController;const p=r===c;p?l(r,'<div class="search-dropdown-loading">Searching…</div>'):E('<div class="search-dropdown-loading">Searching…</div>');try{const b=await fetch(`/wp-json/avscanner/v1/posts?search=${encodeURIComponent(n)}&per_page=5`,{signal:A.signal});if(!b.ok)throw new Error(b.statusText);const v=await b.json(),T=q(v,n,f);p?l(r,T):E(T),i=-1}catch(b){if(b.name==="AbortError")return;M("inline-search",b),p?l(r,""):S()}}if(t.addEventListener("input",()=>{clearTimeout(w);const n=t.value.trim();if(n.length<2){S();return}const r=t.closest("form").action;w=setTimeout(()=>m(n,e,r),300)}),t.addEventListener("keydown",n=>{if(e.hidden)return;const r=x(e);r.length&&(n.key==="ArrowDown"?(n.preventDefault(),h(e,i<r.length-1?i+1:0)):n.key==="ArrowUp"?(n.preventDefault(),h(e,i>0?i-1:r.length-1)):n.key==="Enter"?i>=0&&r[i]&&(n.preventDefault(),r[i].click()):n.key==="Escape"&&(n.preventDefault(),S()))}),document.addEventListener("click",n=>{n.target.closest(".header-search-wrap")||S()}),t.addEventListener("focus",()=>{t.value.trim().length>=2&&e.innerHTML&&e.hidden&&(e.hidden=!1,t.setAttribute("aria-expanded","true"))}),!s||!o||!c||!u||!y)return;let I=0;function H(){I=window.scrollY,s.hidden=!1,document.body.classList.add("search-open"),document.body.style.top=`-${I}px`,o.focus();const n=o.value.trim();if(n.length>=2){const r=o.closest("form").action;m(n,c,r)}s.addEventListener("keydown",R)}function L(){s.hidden=!0,document.body.classList.remove("search-open"),document.body.style.top="",window.scrollTo(0,I),l(c,""),i=-1,s.removeEventListener("keydown",R),y.focus()}function R(n){if(n.key!=="Tab")return;const r=s.querySelectorAll('button, [href], input, [tabindex]:not([tabindex="-1"])');if(!r.length)return;const f=r[0],p=r[r.length-1];n.shiftKey?document.activeElement===f&&(n.preventDefault(),p.focus()):document.activeElement===p&&(n.preventDefault(),f.focus())}y.addEventListener("click",H),u.addEventListener("click",L),c.addEventListener("touchstart",()=>o.blur(),{passive:!0}),o.addEventListener("input",()=>{clearTimeout(w);const n=o.value.trim();if(n.length<2){l(c,"");return}const r=o.closest("form").action;w=setTimeout(()=>m(n,c,r),300)}),o.addEventListener("keydown",n=>{const r=x(c);if(n.key==="Escape"){n.preventDefault(),L();return}r.length&&(n.key==="ArrowDown"?(n.preventDefault(),h(c,i<r.length-1?i+1:0)):n.key==="ArrowUp"?(n.preventDefault(),h(c,i>0?i-1:r.length-1)):n.key==="Enter"&&i>=0&&r[i]&&(n.preventDefault(),r[i].click()))}),c.addEventListener("click",n=>{n.target.closest(".search-dropdown-item")&&L()}),document.addEventListener("keydown",n=>{n.key==="Escape"&&!s.hidden&&L()})}function Q(){const t="avs_scroll_pos",e=document.querySelector("[data-infinite-scroll]");if(e){e.addEventListener("click",o=>{o.target.closest("a")&&sessionStorage.setItem(t,JSON.stringify({scrollY:window.scrollY}))});const s=sessionStorage.getItem(t);if(s){sessionStorage.removeItem(t);try{const{scrollY:o}=JSON.parse(s);o&&requestAnimationFrame(()=>window.scrollTo(0,o))}catch{}}}}function P(){window.addEventListener("scroll",$,{passive:!0}),d==null||d.addEventListener("click",j),a==null||a.querySelectorAll(".nav-link").forEach(t=>{t.addEventListener("click",D)}),document.addEventListener("keydown",t=>{t.key==="Escape"&&D()}),$(),K(),B||(F(),U(),V()),X(),Q(),W(),_(),J(),z()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",P):P()})();
