(function(){const q=window.matchMedia("(prefers-reduced-motion: reduce)").matches,h=document.querySelector(".site-header"),g=document.querySelector(".category-nav");function w(){window.scrollY>50?(h==null||h.classList.add("is-scrolled"),g==null||g.classList.add("is-scrolled")):(h==null||h.classList.remove("is-scrolled"),g==null||g.classList.remove("is-scrolled"))}const l=document.querySelector(".menu-toggle"),i=document.querySelector(".nav-mobile");function M(){const e=(l==null?void 0:l.getAttribute("aria-expanded"))==="true";l==null||l.setAttribute("aria-expanded",!e),i==null||i.classList.toggle("is-open"),i==null||i.setAttribute("aria-hidden",e),document.body.classList.toggle("menu-open")}function L(){l==null||l.setAttribute("aria-expanded","false"),i==null||i.classList.remove("is-open"),i==null||i.setAttribute("aria-hidden","true"),document.body.classList.remove("menu-open")}function $(){const e=document.querySelectorAll(".reveal");if(!e.length)return;const t={root:null,rootMargin:"0px 0px -10% 0px",threshold:.1},n=new IntersectionObserver(s=>{s.forEach(a=>{a.isIntersecting&&a.target.classList.add("is-visible")})},t);e.forEach(s=>{n.observe(s)})}function I(){const e=document.querySelectorAll(".stagger-children");if(!e.length)return;const t={root:null,rootMargin:"0px 0px -10% 0px",threshold:.1},n=new IntersectionObserver(s=>{s.forEach(a=>{a.isIntersecting&&a.target.classList.add("is-visible")})},t);e.forEach(s=>{n.observe(s)})}function C(){document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){const n=this.getAttribute("href");if(n==="#")return;const s=document.querySelector(n);if(s){t.preventDefault();const a=(h==null?void 0:h.offsetHeight)||0,r=s.getBoundingClientRect().top+window.pageYOffset-a-20;window.scrollTo({top:r,behavior:"smooth"}),L()}})})}function S(){document.querySelectorAll(".card-image img, .single-image img").forEach(t=>{t.complete&&t.naturalHeight>0?t.classList.add("is-loaded"):(t.addEventListener("load",()=>t.classList.add("is-loaded"),{once:!0}),t.addEventListener("error",()=>t.classList.add("is-loaded"),{once:!0}))})}function _(){const e=document.querySelectorAll("[data-year]"),t=new Date().getFullYear();e.forEach(n=>{n.textContent=t})}function T(){const e=document.querySelector(".theme-toggle");if(!e)return;const t=localStorage.getItem("cvw-theme");(t==="light"||t==="dark")&&(document.documentElement.dataset.theme=t),e.addEventListener("click",()=>{const s=document.documentElement.dataset.theme==="light"?"dark":"light";document.documentElement.dataset.theme=s,localStorage.setItem("cvw-theme",s)})}function P(){const e=document.querySelector(".back-to-top");e&&(window.addEventListener("scroll",()=>{window.scrollY>400?(e.hidden=!1,requestAnimationFrame(()=>e.classList.add("is-visible"))):(e.classList.remove("is-visible"),e.addEventListener("transitionend",()=>{e.classList.contains("is-visible")||(e.hidden=!0)},{once:!0}))},{passive:!0}),e.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})}))}function H(){const e=document.querySelectorAll(".grid.stagger-children"),t=document.getElementById("card-skeleton");!e.length||!t||e.forEach(n=>{const s=n.querySelectorAll(".card");if(!s.length)return;const a=Math.min(s.length,6),r=document.createElement("div");r.className="skeleton-grid",r.classList.add("grid","grid-3");for(let o=0;o<a;o++)r.appendChild(t.content.cloneNode(!0));n.parentNode.insertBefore(r,n),n.style.display="none";const u=n.querySelectorAll(".card-image img");if(!u.length){E(r,n);return}let f=0;const c=u.length;function d(){f++,f>=c&&E(r,n)}u.forEach(o=>{o.complete&&o.naturalHeight>0?d():(o.addEventListener("load",d,{once:!0}),o.addEventListener("error",d,{once:!0}))}),setTimeout(()=>E(r,n),5e3)})}function E(e,t){e.parentNode&&(e.classList.add("skeleton-fade-out"),t.style.display="",e.addEventListener("transitionend",()=>{e.remove()},{once:!0}),setTimeout(()=>e.remove(),400))}function m(e){const t=document.createElement("div");return t.textContent=e||"",t.innerHTML}function O(e){const t=document.getElementById("card-skeleton");return t?Array.from({length:e},()=>{const n=t.content.cloneNode(!0).firstElementChild;return n.classList.add("infinite-scroll-skeleton"),n}):[]}function B(e){var u,f;const t=document.createElement("article"),n=(u=e.categories_detail)==null?void 0:u.some(c=>c.slug==="advertisement");t.className="card card-hover"+(n?" card-sponsored":"");let s="";if(e.thumbnail_url||e.thumbnail_html){const c=e.video_url?" has-video":"",d=e.video_url?'<span class="card-play-icon" aria-hidden="true"><svg width="48" height="48" viewBox="0 0 48 48" fill="none"><circle cx="24" cy="24" r="24" fill="rgba(0,0,0,0.6)"/><path d="M19 15l14 9-14 9V15z" fill="white"/></svg></span>':"",o=e.thumbnail_html?e.thumbnail_html:`<img src="${e.thumbnail_url}" alt="${m(e.title)}" loading="lazy" decoding="async">`;s=`<a href="${e.permalink}" class="card-image-link${c}"><div class="card-image">${o}${d}</div></a>`}let a="";(f=e.categories_detail)!=null&&f.length&&(n?a='<div class="card-badges"><span class="badge badge-sponsored">Sponsored</span></div>':a='<div class="card-badges">'+e.categories_detail.map(c=>`<a href="${c.link}" class="badge badge-${c.slug}">${m(c.name)}</a>`).join("")+"</div>");let r="";if(e.shared_url)try{const c=new URL(e.shared_url).hostname;r=`<span class="card-source">via ${m(c)}</span>`}catch{}return t.innerHTML=`
        ${s}
        <span class="card-date">${m(e.date_short)} at ${m(e.time)}</span>
        ${a}
        ${r}
        <h3 class="card-title"><a href="${e.permalink}">${m(e.title)}</a></h3>
        <p class="card-text">${m(e.excerpt_short)}</p>
        <a href="${e.permalink}" class="card-link">Read more <svg width="16" height="16" viewBox="0 0 20 20" fill="none"><path d="M4.167 10h11.666M10 4.167L15.833 10 10 15.833" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></a>
    `,t}function R(){const e=document.querySelectorAll("[data-infinite-scroll]");e.length&&e.forEach(t=>{const n=parseInt(t.dataset.perPage)||12,s=parseInt(t.dataset.totalPages)||1,a=t.dataset.category||"";let r=parseInt(t.dataset.currentPage)||1,u=!1;const f=t.nextElementSibling;if(!f)return;const c=f.querySelector(".infinite-scroll-sentinel"),d=f.querySelector(".infinite-scroll-load-more"),o=f.querySelector(".infinite-scroll-status");if(r>=s)return;const x=new IntersectionObserver(p=>{p[0].isIntersecting&&!u&&A()},{rootMargin:"200px"});x.observe(c),d.hidden=!1,d.addEventListener("click",A);async function A(){if(u||r>=s)return;u=!0,d.hidden=!0,o.hidden=!1,o.textContent="Loading more posts…";const p=O(3);t.append(...p);try{const y=new URLSearchParams({page:r+1,per_page:n});a&&y.set("category",a);const v=await fetch(`/wp-json/avscanner/v1/posts?${y}`);if(!v.ok)throw new Error(v.statusText);const Y=await v.json(),j=parseInt(v.headers.get("X-WP-TotalPages"))||s;p.forEach(b=>b.remove()),Y.forEach(b=>{const F=B(b);t.appendChild(F)}),r++,t.dataset.currentPage=r,r>=j?(x.disconnect(),d.hidden=!0,o.hidden=!1,o.textContent="All posts loaded"):(d.hidden=!1,o.hidden=!0),S()}catch{p.forEach(v=>v.remove()),d.hidden=!1,o.hidden=!1,o.textContent="Failed to load — try again"}u=!1}})}function k(){window.addEventListener("scroll",w,{passive:!0}),l==null||l.addEventListener("click",M),i==null||i.querySelectorAll(".nav-link").forEach(e=>{e.addEventListener("click",L)}),document.addEventListener("keydown",e=>{e.key==="Escape"&&L()}),w(),T(),q||(H(),$(),I(),C()),R(),S(),_(),P()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",k):k()})();
