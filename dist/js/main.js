(function(){function M(e,t){console.error(`[AVScanner] ${e}:`,t)}window.addEventListener("unhandledrejection",e=>{M("unhandled-promise",e.reason)});const R=window.matchMedia("(prefers-reduced-motion: reduce)").matches,v=document.querySelector(".site-header"),$=document.querySelector(".category-nav");function C(){window.scrollY>50?(v==null||v.classList.add("is-scrolled"),$==null||$.classList.add("is-scrolled")):(v==null||v.classList.remove("is-scrolled"),$==null||$.classList.remove("is-scrolled"))}const f=document.querySelector(".menu-toggle"),l=document.querySelector(".nav-mobile");function P(){const e=(f==null?void 0:f.getAttribute("aria-expanded"))==="true";f==null||f.setAttribute("aria-expanded",!e),l==null||l.classList.toggle("is-open"),l==null||l.setAttribute("aria-hidden",e),document.body.classList.toggle("menu-open")}function T(){f==null||f.setAttribute("aria-expanded","false"),l==null||l.classList.remove("is-open"),l==null||l.setAttribute("aria-hidden","true"),document.body.classList.remove("menu-open")}function Y(){const e=document.querySelectorAll(".reveal");if(!e.length)return;const t={root:null,rootMargin:"0px 0px -10% 0px",threshold:.1},s=new IntersectionObserver(r=>{r.forEach(a=>{a.isIntersecting&&a.target.classList.add("is-visible")})},t);e.forEach(r=>{s.observe(r)})}function B(){const e=document.querySelectorAll(".stagger-children");if(!e.length)return;const t={root:null,rootMargin:"0px 0px -10% 0px",threshold:.1},s=new IntersectionObserver(r=>{r.forEach(a=>{a.isIntersecting&&a.target.classList.add("is-visible")})},t);e.forEach(r=>{s.observe(r)})}function j(){document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){const s=this.getAttribute("href");if(s==="#")return;const r=document.querySelector(s);if(r){t.preventDefault();const a=(v==null?void 0:v.offsetHeight)||0,u=r.getBoundingClientRect().top+window.pageYOffset-a-20;window.scrollTo({top:u,behavior:"smooth"}),T()}})})}function H(){document.querySelectorAll(".card-image img, .single-image img").forEach(t=>{t.complete&&t.naturalHeight>0?t.classList.add("is-loaded"):(t.addEventListener("load",()=>t.classList.add("is-loaded"),{once:!0}),t.addEventListener("error",()=>t.classList.add("is-loaded"),{once:!0}))})}function F(){const e=document.querySelectorAll("[data-year]"),t=new Date().getFullYear();e.forEach(s=>{s.textContent=t})}function U(){const e=document.querySelector(".theme-toggle");if(!e)return;const t=localStorage.getItem("cvw-theme");(t==="light"||t==="dark")&&(document.documentElement.dataset.theme=t),e.addEventListener("click",()=>{const r=document.documentElement.dataset.theme==="light"?"dark":"light";document.documentElement.dataset.theme=r,localStorage.setItem("cvw-theme",r)})}function V(){const e=document.querySelector(".back-to-top");e&&(window.addEventListener("scroll",()=>{window.scrollY>400?(e.hidden=!1,requestAnimationFrame(()=>e.classList.add("is-visible"))):(e.classList.remove("is-visible"),e.addEventListener("transitionend",()=>{e.classList.contains("is-visible")||(e.hidden=!0)},{once:!0}))},{passive:!0}),e.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})}))}function m(e){const t=document.createElement("div");return t.textContent=e||"",t.innerHTML}function z(e){const t=document.getElementById("card-skeleton");return t?Array.from({length:e},()=>{const s=t.content.cloneNode(!0).firstElementChild;return s.classList.add("infinite-scroll-skeleton"),s}):[]}function J(e){var g,h;const t=document.createElement("article"),s=(g=e.categories_detail)==null?void 0:g.some(c=>c.slug==="advertisement");t.className="card card-hover"+(s?" card-sponsored":"");let r="";if(e.thumbnail_url||e.thumbnail_html){const c=e.video_url?" has-video":"",o=e.video_url?'<span class="card-play-icon" aria-hidden="true"><svg width="48" height="48" viewBox="0 0 48 48" fill="none"><circle cx="24" cy="24" r="24" fill="rgba(0,0,0,0.6)"/><path d="M19 15l14 9-14 9V15z" fill="white"/></svg></span>':"",d=e.thumbnail_html?e.thumbnail_html:`<img src="${e.thumbnail_url}" alt="${m(e.title)}" loading="lazy" decoding="async">`;r=`<a href="${e.permalink}" class="card-image-link${c}"><div class="card-image">${d}${o}</div></a>`}let a="";(h=e.categories_detail)!=null&&h.length&&(s?a='<div class="card-badges"><span class="badge badge-sponsored">Sponsored</span></div>':a='<div class="card-badges">'+e.categories_detail.map(c=>`<a href="${c.link}" class="badge badge-${c.slug}">${m(c.name)}</a>`).join("")+"</div>");let u="";if(e.shared_url)try{const c=new URL(e.shared_url).hostname;u=`<span class="card-source">via ${m(c)}</span>`}catch{}return t.innerHTML=`
        ${r}
        <span class="card-date">${m(e.date_short)} at ${m(e.time)}</span>
        ${a}
        ${u}
        <h3 class="card-title"><a href="${e.permalink}">${m(e.title)}</a></h3>
        <p class="card-text">${m(e.excerpt_short)}</p>
        <a href="${e.permalink}" class="card-link">Read more <svg width="16" height="16" viewBox="0 0 20 20" fill="none"><path d="M4.167 10h11.666M10 4.167L15.833 10 10 15.833" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></a>
    `,t}function G(){const e=document.querySelectorAll("[data-infinite-scroll]");e.length&&e.forEach(t=>{const s=parseInt(t.dataset.perPage)||12,r=parseInt(t.dataset.totalPages)||1,a=t.dataset.category||"";let u=parseInt(t.dataset.currentPage)||1,g=!1;const h=t.nextElementSibling;if(!h)return;const c=h.querySelector(".infinite-scroll-sentinel"),o=h.querySelector(".infinite-scroll-load-more"),d=h.querySelector(".infinite-scroll-status");if(u>=r)return;const x=new IntersectionObserver(w=>{w[0].isIntersecting&&!g&&S()},{rootMargin:"200px"});x.observe(c),o.hidden=!1,o.addEventListener("click",S);async function S(){if(g||u>=r)return;g=!0,o.hidden=!0,d.hidden=!1,d.textContent="Loading more posts…";const w=z(3);t.append(...w);try{const y=new URLSearchParams({page:u+1,per_page:s});a&&y.set("category",a);const L=await fetch(`/wp-json/avscanner/v1/posts?${y}`);if(!L.ok)throw new Error(L.statusText);const q=await L.json(),_=parseInt(L.headers.get("X-WP-TotalPages"))||r;w.forEach(E=>E.remove()),q.forEach(E=>{const n=J(E);t.appendChild(n)}),u++,t.dataset.currentPage=u,u>=_?(x.disconnect(),o.hidden=!0,d.hidden=!1,d.textContent="All posts loaded"):(o.hidden=!1,d.hidden=!0),H()}catch(y){M("infinite-scroll",y),w.forEach(L=>L.remove()),o.hidden=!1,d.hidden=!1,d.textContent="Failed to load — try again"}g=!1}})}function K(){const e=document.getElementById("header-search-input"),t=document.getElementById("search-dropdown");if(!e||!t)return;const s=document.querySelector(".search-overlay"),r=s==null?void 0:s.querySelector(".search-overlay-input"),a=s==null?void 0:s.querySelector(".search-overlay-results"),u=s==null?void 0:s.querySelector(".search-overlay-back"),g=document.querySelector(".search-trigger");window.matchMedia("(max-width: 639px)");let h=null,c=null,o=-1;function d(n,i){n.innerHTML=i}function x(n){t.innerHTML=n,t.hidden=!1,e.setAttribute("aria-expanded","true")}function S(){t.hidden=!0,t.innerHTML="",e.setAttribute("aria-expanded","false"),o=-1}function w(n){return n.querySelectorAll(".search-dropdown-item")}function y(n,i){const b=w(n);b.forEach(A=>A.classList.remove("is-active")),o=i,b[o]&&(b[o].classList.add("is-active"),b[o].scrollIntoView({block:"nearest"}))}function L(n,i,b){if(!n.length)return'<div class="search-dropdown-empty">No results found</div>';const A=n.map(p=>{var D;const I=p.thumbnail_url?`<img class="search-dropdown-thumb" src="${p.thumbnail_url}" alt="" loading="lazy" decoding="async">`:"",X=(D=p.categories_detail)!=null&&D.length?`<span class="badge badge-${p.categories_detail[0].slug}">${m(p.categories_detail[0].name)}</span>`:"";return`<a class="search-dropdown-item" href="${p.permalink}" role="option">
            ${I}
            <span class="search-dropdown-body">
              <span class="search-dropdown-title">${m(p.title)}</span>
              <span class="search-dropdown-meta">${X}<span>${m(p.date_short)}</span></span>
            </span>
          </a>`}).join(""),k=`<a class="search-dropdown-footer" href="${b}?s=${encodeURIComponent(i)}&post_type=fb_post">View all results →</a>`;return A+k}async function q(n,i,b){c&&c.abort(),c=new AbortController;const A=i===a;A?d(i,'<div class="search-dropdown-loading">Searching…</div>'):x('<div class="search-dropdown-loading">Searching…</div>');try{const k=await fetch(`/wp-json/avscanner/v1/posts?search=${encodeURIComponent(n)}&per_page=5`,{signal:c.signal});if(!k.ok)throw new Error(k.statusText);const p=await k.json(),I=L(p,n,b);A?d(i,I):x(I),o=-1}catch(k){if(k.name==="AbortError")return;M("inline-search",k),A?d(i,""):S()}}if(e.addEventListener("input",()=>{clearTimeout(h);const n=e.value.trim();if(n.length<2){S();return}const i=e.closest("form").action;h=setTimeout(()=>q(n,t,i),300)}),e.addEventListener("keydown",n=>{if(t.hidden)return;const i=w(t);i.length&&(n.key==="ArrowDown"?(n.preventDefault(),y(t,o<i.length-1?o+1:0)):n.key==="ArrowUp"?(n.preventDefault(),y(t,o>0?o-1:i.length-1)):n.key==="Enter"?o>=0&&i[o]&&(n.preventDefault(),i[o].click()):n.key==="Escape"&&(n.preventDefault(),S()))}),document.addEventListener("click",n=>{n.target.closest(".header-search-wrap")||S()}),e.addEventListener("focus",()=>{e.value.trim().length>=2&&t.innerHTML&&t.hidden&&(t.hidden=!1,e.setAttribute("aria-expanded","true"))}),!s||!r||!a||!u||!g)return;function _(){s.hidden=!1,document.body.classList.add("search-open"),requestAnimationFrame(()=>r.focus());const n=r.value.trim();if(n.length>=2){const i=r.closest("form").action;q(n,a,i)}}function E(){s.hidden=!0,document.body.classList.remove("search-open"),d(a,""),o=-1}g.addEventListener("click",_),u.addEventListener("click",E),r.addEventListener("input",()=>{clearTimeout(h);const n=r.value.trim();if(n.length<2){d(a,"");return}const i=r.closest("form").action;h=setTimeout(()=>q(n,a,i),300)}),r.addEventListener("keydown",n=>{const i=w(a);if(n.key==="Escape"){n.preventDefault(),E();return}i.length&&(n.key==="ArrowDown"?(n.preventDefault(),y(a,o<i.length-1?o+1:0)):n.key==="ArrowUp"?(n.preventDefault(),y(a,o>0?o-1:i.length-1)):n.key==="Enter"&&o>=0&&i[o]&&(n.preventDefault(),i[o].click()))}),a.addEventListener("click",n=>{n.target.closest(".search-dropdown-item")&&E()}),document.addEventListener("keydown",n=>{n.key==="Escape"&&!s.hidden&&E()})}function W(){const e="avs_scroll_pos",t=document.querySelector("[data-infinite-scroll]");if(t){t.addEventListener("click",r=>{r.target.closest("a")&&sessionStorage.setItem(e,JSON.stringify({scrollY:window.scrollY}))});const s=sessionStorage.getItem(e);if(s){sessionStorage.removeItem(e);try{const{scrollY:r}=JSON.parse(s);r&&requestAnimationFrame(()=>window.scrollTo(0,r))}catch{}}}}function O(){window.addEventListener("scroll",C,{passive:!0}),f==null||f.addEventListener("click",P),l==null||l.querySelectorAll(".nav-link").forEach(e=>{e.addEventListener("click",T)}),document.addEventListener("keydown",e=>{e.key==="Escape"&&T()}),C(),U(),R||(Y(),B(),j()),K(),W(),G(),H(),F(),V()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",O):O()})();
