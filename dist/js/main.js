(function(){function _(t,e){console.error(`[AVScanner] ${t}:`,e)}window.addEventListener("unhandledrejection",t=>{_("unhandled-promise",t.reason)});const M=window.matchMedia("(prefers-reduced-motion: reduce)").matches,k=document.querySelector(".site-header"),q=document.querySelector(".category-nav");function D(){window.scrollY>50?(k==null||k.classList.add("is-scrolled"),q==null||q.classList.add("is-scrolled")):(k==null||k.classList.remove("is-scrolled"),q==null||q.classList.remove("is-scrolled"))}const g=document.querySelector(".menu-toggle"),h=document.querySelector(".nav-mobile");function O(){const t=(g==null?void 0:g.getAttribute("aria-expanded"))==="true";g==null||g.setAttribute("aria-expanded",!t),h==null||h.classList.toggle("is-open"),h==null||h.setAttribute("aria-hidden",t),document.body.classList.toggle("menu-open")}function C(){g==null||g.setAttribute("aria-expanded","false"),h==null||h.classList.remove("is-open"),h==null||h.setAttribute("aria-hidden","true"),document.body.classList.remove("menu-open")}function P(t){const e=t.getBoundingClientRect();return e.top<window.innerHeight&&e.bottom>0}function Y(){const t=document.querySelectorAll(".reveal");if(!t.length)return;const e=new IntersectionObserver(s=>{s.forEach(r=>{r.isIntersecting&&r.target.classList.add("is-visible")})},{rootMargin:"0px 0px -10% 0px",threshold:.1});t.forEach(s=>{P(s)?s.classList.add("is-visible"):e.observe(s)})}function U(){const t=document.querySelectorAll(".stagger-children");if(!t.length)return;const e=new IntersectionObserver(s=>{s.forEach(r=>{r.isIntersecting&&r.target.classList.add("is-visible")})},{rootMargin:"0px 0px -10% 0px",threshold:.1});t.forEach(s=>{P(s)?s.classList.add("is-visible"):e.observe(s)})}function j(){document.querySelectorAll('a[href^="#"]').forEach(t=>{t.addEventListener("click",function(e){const s=this.getAttribute("href");if(s==="#")return;const r=document.querySelector(s);if(r){e.preventDefault();const a=(k==null?void 0:k.offsetHeight)||0,l=r.getBoundingClientRect().top+window.pageYOffset-a-20;window.scrollTo({top:l,behavior:"smooth"}),C()}})})}function B(){document.querySelectorAll(".card-image img, .single-image img").forEach(e=>{e.complete&&e.naturalHeight>0?e.classList.add("is-loaded"):(e.addEventListener("load",()=>e.classList.add("is-loaded"),{once:!0}),e.addEventListener("error",()=>e.classList.add("is-loaded"),{once:!0}))})}function V(){const t=document.querySelectorAll("[data-year]"),e=new Date().getFullYear();t.forEach(s=>{s.textContent=e})}function z(){const t=document.querySelector(".theme-toggle");if(!t)return;const e=localStorage.getItem("cvw-theme");(e==="light"||e==="dark")&&(document.documentElement.dataset.theme=e),t.addEventListener("click",()=>{const r=document.documentElement.dataset.theme==="light"?"dark":"light";document.documentElement.dataset.theme=r,localStorage.setItem("cvw-theme",r)})}function G(){const t=document.querySelector(".back-to-top");t&&(window.addEventListener("scroll",()=>{window.scrollY>400?(t.hidden=!1,requestAnimationFrame(()=>t.classList.add("is-visible"))):(t.classList.remove("is-visible"),t.addEventListener("transitionend",()=>{t.classList.contains("is-visible")||(t.hidden=!0)},{once:!0}))},{passive:!0}),t.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})}))}function J(t){const e=document.getElementById("card-skeleton");return e?Array.from({length:t},()=>{const s=e.content.cloneNode(!0).firstElementChild;return s.classList.add("infinite-scroll-skeleton"),s}):[]}function K(){const t=document.querySelectorAll("[data-infinite-scroll]");t.length&&t.forEach(e=>{const s=parseInt(e.dataset.perPage)||12,r=parseInt(e.dataset.totalPages)||1,a=e.dataset.category||"";let l=parseInt(e.dataset.currentPage)||1,f=!1;const d=e.nextElementSibling;if(!d)return;d.querySelector(".infinite-scroll-sentinel");const c=d.querySelector(".infinite-scroll-load-more"),o=d.querySelector(".infinite-scroll-status"),u=document.createElement("div");if(u.className="sr-only",u.setAttribute("aria-live","polite"),u.setAttribute("aria-atomic","true"),e.parentNode.insertBefore(u,e.nextSibling),l>=r)return;c.hidden=!1,c.addEventListener("click",m);async function m(){if(f||l>=r)return;f=!0,c.hidden=!0,o.hidden=!1,o.textContent="Loading more posts…";const v=J(3);e.append(...v);try{const y=new URLSearchParams({page:l+1,per_page:s});a&&y.set("category",a);const w=await fetch(`/wp-json/avscannertheme/v1/cards?${y}`);if(!w.ok)throw new Error(w.statusText);const p=await w.json(),S=parseInt(w.headers.get("X-WP-TotalPages"))||r;v.forEach(E=>E.remove()),p.cards.forEach(E=>{e.insertAdjacentHTML("beforeend",E)}),u.textContent=`Loaded ${p.cards.length} more posts`,l++,e.dataset.currentPage=l,l>=S?(c.hidden=!0,o.hidden=!1,o.textContent="All posts loaded"):(c.hidden=!1,o.hidden=!0),B()}catch(y){_("infinite-scroll",y),v.forEach(w=>w.remove()),c.hidden=!1,o.hidden=!1,o.textContent="Failed to load — try again"}f=!1}})}function R(t){const e=document.createElement("div");return e.textContent=t||"",e.innerHTML}function W(){const t=document.getElementById("header-search-input"),e=document.getElementById("search-dropdown");if(!t||!e)return;const s=document.querySelector(".search-overlay"),r=s==null?void 0:s.querySelector(".search-overlay-input"),a=s==null?void 0:s.querySelector(".search-overlay-results"),l=s==null?void 0:s.querySelector(".search-overlay-back"),f=document.querySelector(".search-trigger");window.matchMedia("(max-width: 639px)");let d=null,c=null,o=-1;function u(n,i){n.innerHTML=i}function m(n){e.innerHTML=n,e.hidden=!1,t.setAttribute("aria-expanded","true")}function v(){e.hidden=!0,e.innerHTML="",t.setAttribute("aria-expanded","false"),o=-1}function y(n){return n.querySelectorAll(".search-dropdown-item")}function w(n,i){const L=y(n);L.forEach(b=>b.classList.remove("is-active")),o=i,L[o]&&(L[o].classList.add("is-active"),L[o].scrollIntoView({block:"nearest"}))}function p(n,i,L){if(!n.length)return'<div class="search-dropdown-empty">No results found</div>';const b=n.map(A=>{var $;const I=A.thumbnail_url?`<img class="search-dropdown-thumb" src="${A.thumbnail_url}" alt="" loading="lazy" decoding="async">`:"",te=($=A.categories_detail)!=null&&$.length?`<span class="badge badge-${A.categories_detail[0].slug}">${R(A.categories_detail[0].name)}</span>`:"";return`<a class="search-dropdown-item" href="${A.permalink}" role="option" tabindex="-1">
            ${I}
            <span class="search-dropdown-body">
              <span class="search-dropdown-title">${R(A.title)}</span>
              <span class="search-dropdown-meta">${te}<span>${R(A.date_short)}</span></span>
            </span>
          </a>`}).join(""),x=`<a class="search-dropdown-footer" href="${L}?s=${encodeURIComponent(i)}&post_type=fb_post" tabindex="-1">View all results →</a>`;return b+x}async function S(n,i,L){c&&c.abort(),c=new AbortController;const b=i===a;b?u(i,'<div class="search-dropdown-loading">Searching…</div>'):m('<div class="search-dropdown-loading">Searching…</div>');try{const x=await fetch(`/wp-json/avscanner/v1/posts?search=${encodeURIComponent(n)}&per_page=5`,{signal:c.signal});if(!x.ok)throw new Error(x.statusText);const A=await x.json(),I=p(A,n,L);b?u(i,I):m(I),o=-1}catch(x){if(x.name==="AbortError")return;_("inline-search",x),b?u(i,""):v()}}if(t.addEventListener("input",()=>{clearTimeout(d);const n=t.value.trim();if(n.length<2){v();return}const i=t.closest("form").action;d=setTimeout(()=>S(n,e,i),300)}),t.addEventListener("keydown",n=>{if(e.hidden)return;if(n.key==="Tab"){v();return}const i=y(e);i.length&&(n.key==="ArrowDown"?(n.preventDefault(),w(e,o<i.length-1?o+1:0)):n.key==="ArrowUp"?(n.preventDefault(),w(e,o>0?o-1:i.length-1)):n.key==="Enter"?o>=0&&i[o]&&(n.preventDefault(),i[o].click()):n.key==="Escape"&&(n.preventDefault(),v()))}),document.addEventListener("click",n=>{n.target.closest(".header-search-wrap")||v()}),t.addEventListener("focus",()=>{t.value.trim().length>=2&&e.innerHTML&&e.hidden&&(e.hidden=!1,t.setAttribute("aria-expanded","true"))}),!s||!r||!a||!l||!f)return;let E=0;function ee(){E=window.scrollY,s.hidden=!1,document.body.classList.add("search-open"),document.body.style.top=`-${E}px`,r.focus();const n=r.value.trim();if(n.length>=2){const i=r.closest("form").action;S(n,a,i)}s.addEventListener("keydown",H)}function T(){s.hidden=!0,document.body.classList.remove("search-open"),document.body.style.top="",window.scrollTo(0,E),u(a,""),o=-1,s.removeEventListener("keydown",H),f.focus()}function H(n){if(n.key!=="Tab")return;const i=s.querySelectorAll('button, [href], input, [tabindex]:not([tabindex="-1"])');if(!i.length)return;const L=i[0],b=i[i.length-1];n.shiftKey?document.activeElement===L&&(n.preventDefault(),b.focus()):document.activeElement===b&&(n.preventDefault(),L.focus())}f.addEventListener("click",ee),l.addEventListener("click",T),a.addEventListener("touchstart",()=>r.blur(),{passive:!0}),r.addEventListener("input",()=>{clearTimeout(d);const n=r.value.trim();if(n.length<2){u(a,"");return}const i=r.closest("form").action;d=setTimeout(()=>S(n,a,i),300)}),r.addEventListener("keydown",n=>{const i=y(a);if(n.key==="Escape"){n.preventDefault(),T();return}i.length&&(n.key==="ArrowDown"?(n.preventDefault(),w(a,o<i.length-1?o+1:0)):n.key==="ArrowUp"?(n.preventDefault(),w(a,o>0?o-1:i.length-1)):n.key==="Enter"&&o>=0&&i[o]&&(n.preventDefault(),i[o].click()))}),a.addEventListener("click",n=>{n.target.closest(".search-dropdown-item")&&T()}),document.addEventListener("keydown",n=>{n.key==="Escape"&&!s.hidden&&T()})}function X(){const t="avs_scroll_pos",e=document.querySelector("[data-infinite-scroll]");if(e){e.addEventListener("click",r=>{r.target.closest("a")&&sessionStorage.setItem(t,JSON.stringify({scrollY:window.scrollY}))});const s=sessionStorage.getItem(t);if(s){sessionStorage.removeItem(t);try{const{scrollY:r}=JSON.parse(s);r&&requestAnimationFrame(()=>window.scrollTo(0,r))}catch{}}}}function Q(){const t=!!navigator.share;document.querySelectorAll(".share-btn-native").forEach(e=>{var s;t&&(e.hidden=!1,(s=e.nextElementSibling)==null||s.classList.add("share-buttons-hidden"),e.addEventListener("click",async()=>{try{await navigator.share({title:e.dataset.shareTitle,url:e.dataset.shareUrl})}catch{}}))}),document.querySelectorAll(".copy-link-btn").forEach(e=>{e.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(e.dataset.url||location.href),e.classList.add("is-copied"),setTimeout(()=>e.classList.remove("is-copied"),2e3)}catch{}})})}function Z(){const t=document.getElementById("hero-scanner");if(!t)return;const e=t.getContext("webgl",{alpha:!0,antialias:!1});if(!e)return;const s=`
      attribute vec2 a_pos;
      void main() { gl_Position = vec4(a_pos, 0.0, 1.0); }
    `,r=`
      precision mediump float;
      uniform float u_time;
      uniform vec2 u_res;

      void main() {
        vec2 uv = gl_FragCoord.xy / u_res;
        // Center point for sweep — right side, vertically centered
        vec2 center = vec2(0.85, 0.5);
        vec2 d = uv - center;
        float aspect = u_res.x / u_res.y;
        d.x *= aspect;

        float angle = atan(d.y, d.x);
        float dist = length(d);

        // Sweep — slow rotation
        float sweep = u_time * 0.4;
        float diff = mod(angle - sweep, 6.2832);

        // Soft fade trail behind sweep line
        float trail = smoothstep(0.0, 1.0, diff) * (1.0 - smoothstep(1.0, 2.8, diff));
        trail *= smoothstep(0.8, 0.0, dist);

        // Concentric rings
        float rings = sin(dist * 20.0 - u_time * 0.5) * 0.5 + 0.5;
        rings = smoothstep(0.42, 0.58, rings) * 0.15;
        rings *= smoothstep(0.7, 0.0, dist);

        // Subtle grid dots
        vec2 grid = fract(uv * vec2(40.0, 20.0));
        float dots = step(0.9, max(grid.x, grid.y)) * 0.04;

        // Center glow
        float glow = smoothstep(0.15, 0.0, dist) * 0.25;

        // Combine — deep red/crimson tones
        float intensity = trail * 0.3 + rings + dots + glow;
        vec3 color = vec3(0.86, 0.1, 0.1) * intensity;

        gl_FragColor = vec4(color, intensity);
      }
    `;function a(p,S){const E=e.createShader(p);return e.shaderSource(E,S),e.compileShader(E),E}const l=e.createProgram();e.attachShader(l,a(e.VERTEX_SHADER,s)),e.attachShader(l,a(e.FRAGMENT_SHADER,r)),e.linkProgram(l),e.useProgram(l);const f=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,f),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,1]),e.STATIC_DRAW);const d=e.getAttribLocation(l,"a_pos");e.enableVertexAttribArray(d),e.vertexAttribPointer(d,2,e.FLOAT,!1,0,0);const c=e.getUniformLocation(l,"u_time"),o=e.getUniformLocation(l,"u_res");let u,m=!1;function v(){const p=t.parentElement.getBoundingClientRect(),S=Math.min(window.devicePixelRatio,2);t.width=p.width*S,t.height=p.height*S,e.viewport(0,0,t.width,t.height)}function y(p){e.uniform1f(c,p*.001),e.uniform2f(o,t.width,t.height),e.drawArrays(e.TRIANGLE_STRIP,0,4),m&&(u=requestAnimationFrame(y))}new IntersectionObserver(([p])=>{p.isIntersecting&&!m?(m=!0,v(),u=requestAnimationFrame(y)):!p.isIntersecting&&m&&(m=!1,cancelAnimationFrame(u))}).observe(t),window.addEventListener("resize",()=>{m&&v()},{passive:!0})}function N(){const t=document.getElementById("codes-search-input");if(!t)return;const e=document.querySelectorAll(".codes-section"),s=document.querySelectorAll(".codes-row"),r=document.getElementById("codes-match-count"),a=document.getElementById("codes-empty"),l=document.querySelectorAll(".codes-nav-tab");t.addEventListener("input",()=>{const f=t.value.trim().toLowerCase();if(!f){s.forEach(c=>c.hidden=!1),e.forEach(c=>c.classList.remove("is-hidden")),r&&(r.hidden=!0),a&&(a.hidden=!0);return}let d=0;s.forEach(c=>{const o=c.dataset.code||"",u=c.dataset.desc||"",m=o.includes(f)||u.includes(f);c.hidden=!m,m&&d++}),e.forEach(c=>{const o=c.querySelectorAll(".codes-row:not([hidden])");c.classList.toggle("is-hidden",o.length===0)}),r&&(r.textContent=`${d} result${d!==1?"s":""}`,r.hidden=!1),a&&(a.hidden=d>0)}),l.forEach(f=>{f.addEventListener("click",()=>{t.value="",t.dispatchEvent(new Event("input")),l.forEach(d=>d.classList.remove("is-active")),f.classList.add("is-active")})})}function F(){window.addEventListener("scroll",D,{passive:!0}),g==null||g.addEventListener("click",O),h==null||h.querySelectorAll(".nav-link").forEach(t=>{t.addEventListener("click",C)}),document.addEventListener("keydown",t=>{t.key==="Escape"&&C()}),D(),z(),M||(Y(),U(),j()),W(),X(),K(),B(),V(),G(),Q(),N(),M||Z()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",F):F()})();
