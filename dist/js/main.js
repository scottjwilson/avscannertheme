(function(){function M(t,e){console.error(`[AVScanner] ${t}:`,e)}window.addEventListener("unhandledrejection",t=>{M("unhandled-promise",t.reason)});const Y=window.matchMedia("(prefers-reduced-motion: reduce)").matches,L=document.querySelector(".site-header"),A=document.querySelector(".category-nav");function H(){window.scrollY>50?(L==null||L.classList.add("is-scrolled"),A==null||A.classList.add("is-scrolled")):(L==null||L.classList.remove("is-scrolled"),A==null||A.classList.remove("is-scrolled"))}const m=document.querySelector(".menu-toggle"),d=document.querySelector(".nav-mobile");function j(){const t=(m==null?void 0:m.getAttribute("aria-expanded"))==="true";m==null||m.setAttribute("aria-expanded",!t),d==null||d.classList.toggle("is-open"),d==null||d.setAttribute("aria-hidden",t),document.body.classList.toggle("menu-open")}function C(){m==null||m.setAttribute("aria-expanded","false"),d==null||d.classList.remove("is-open"),d==null||d.setAttribute("aria-hidden","true"),document.body.classList.remove("menu-open")}function O(t){const e=t.getBoundingClientRect();return e.top<window.innerHeight&&e.bottom>0}function F(){const t=document.querySelectorAll(".reveal");if(!t.length)return;const e=new IntersectionObserver(s=>{s.forEach(o=>{o.isIntersecting&&o.target.classList.add("is-visible")})},{rootMargin:"0px 0px -10% 0px",threshold:.1});t.forEach(s=>{O(s)?s.classList.add("is-visible"):e.observe(s)})}function U(){const t=document.querySelectorAll(".stagger-children");if(!t.length)return;const e=new IntersectionObserver(s=>{s.forEach(o=>{o.isIntersecting&&o.target.classList.add("is-visible")})},{rootMargin:"0px 0px -10% 0px",threshold:.1});t.forEach(s=>{O(s)?s.classList.add("is-visible"):e.observe(s)})}function V(){document.querySelectorAll('a[href^="#"]').forEach(t=>{t.addEventListener("click",function(e){const s=this.getAttribute("href");if(s==="#")return;const o=document.querySelector(s);if(o){e.preventDefault();const c=(L==null?void 0:L.offsetHeight)||0,h=o.getBoundingClientRect().top+window.pageYOffset-c-20;window.scrollTo({top:h,behavior:"smooth"}),C()}})})}function B(){document.querySelectorAll(".card-image img, .single-image img").forEach(e=>{e.complete&&e.naturalHeight>0?e.classList.add("is-loaded"):(e.addEventListener("load",()=>e.classList.add("is-loaded"),{once:!0}),e.addEventListener("error",()=>e.classList.add("is-loaded"),{once:!0}))})}function J(){const t=document.querySelectorAll("[data-year]"),e=new Date().getFullYear();t.forEach(s=>{s.textContent=e})}function K(){const t=document.querySelector(".theme-toggle");if(!t)return;const e=localStorage.getItem("cvw-theme");(e==="light"||e==="dark")&&(document.documentElement.dataset.theme=e),t.addEventListener("click",()=>{const o=document.documentElement.dataset.theme==="light"?"dark":"light";document.documentElement.dataset.theme=o,localStorage.setItem("cvw-theme",o)})}function z(){const t=document.querySelector(".back-to-top");t&&(window.addEventListener("scroll",()=>{window.scrollY>400?(t.hidden=!1,requestAnimationFrame(()=>t.classList.add("is-visible"))):(t.classList.remove("is-visible"),t.addEventListener("transitionend",()=>{t.classList.contains("is-visible")||(t.hidden=!0)},{once:!0}))},{passive:!0}),t.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})}))}function G(t){const e=document.getElementById("card-skeleton");return e?Array.from({length:t},()=>{const s=e.content.cloneNode(!0).firstElementChild;return s.classList.add("infinite-scroll-skeleton"),s}):[]}function W(){const t=document.querySelectorAll("[data-infinite-scroll]");t.length&&t.forEach(e=>{const s=parseInt(e.dataset.perPage)||12,o=parseInt(e.dataset.totalPages)||1,c=e.dataset.category||"";let h=parseInt(e.dataset.currentPage)||1,u=!1;const l=e.nextElementSibling;if(!l)return;const a=l.querySelector(".infinite-scroll-sentinel"),i=l.querySelector(".infinite-scroll-load-more"),f=l.querySelector(".infinite-scroll-status"),p=document.createElement("div");if(p.className="sr-only",p.setAttribute("aria-live","polite"),p.setAttribute("aria-atomic","true"),e.parentNode.insertBefore(p,e.nextSibling),h>=o)return;const S=new IntersectionObserver(g=>{g[0].isIntersecting&&!u&&q()},{rootMargin:"200px"});S.observe(a),i.hidden=!1,i.addEventListener("click",q);async function q(){if(u||h>=o)return;u=!0,i.hidden=!0,f.hidden=!1,f.textContent="Loading more posts…";const g=G(3);e.append(...g);try{const x=new URLSearchParams({page:h+1,per_page:s});c&&x.set("category",c);const y=await fetch(`/wp-json/avscannertheme/v1/cards?${x}`);if(!y.ok)throw new Error(y.statusText);const I=await y.json(),$=parseInt(y.headers.get("X-WP-TotalPages"))||o;g.forEach(b=>b.remove()),I.cards.forEach(b=>{e.insertAdjacentHTML("beforeend",b)}),p.textContent=`Loaded ${I.cards.length} more posts`,h++,e.dataset.currentPage=h,h>=$?(S.disconnect(),i.hidden=!0,f.hidden=!1,f.textContent="All posts loaded"):(i.hidden=!1,f.hidden=!0),B()}catch(x){M("infinite-scroll",x),g.forEach(y=>y.remove()),i.hidden=!1,f.hidden=!1,f.textContent="Failed to load — try again"}u=!1}})}function D(t){const e=document.createElement("div");return e.textContent=t||"",e.innerHTML}function X(){const t=document.getElementById("header-search-input"),e=document.getElementById("search-dropdown");if(!t||!e)return;const s=document.querySelector(".search-overlay"),o=s==null?void 0:s.querySelector(".search-overlay-input"),c=s==null?void 0:s.querySelector(".search-overlay-results"),h=s==null?void 0:s.querySelector(".search-overlay-back"),u=document.querySelector(".search-trigger");window.matchMedia("(max-width: 639px)");let l=null,a=null,i=-1;function f(n,r){n.innerHTML=r}function p(n){e.innerHTML=n,e.hidden=!1,t.setAttribute("aria-expanded","true")}function S(){e.hidden=!0,e.innerHTML="",t.setAttribute("aria-expanded","false"),i=-1}function q(n){return n.querySelectorAll(".search-dropdown-item")}function g(n,r){const v=q(n);v.forEach(w=>w.classList.remove("is-active")),i=r,v[i]&&(v[i].classList.add("is-active"),v[i].scrollIntoView({block:"nearest"}))}function x(n,r,v){if(!n.length)return'<div class="search-dropdown-empty">No results found</div>';const w=n.map(E=>{var R;const T=E.thumbnail_url?`<img class="search-dropdown-thumb" src="${E.thumbnail_url}" alt="" loading="lazy" decoding="async">`:"",ee=(R=E.categories_detail)!=null&&R.length?`<span class="badge badge-${E.categories_detail[0].slug}">${D(E.categories_detail[0].name)}</span>`:"";return`<a class="search-dropdown-item" href="${E.permalink}" role="option" tabindex="-1">
            ${T}
            <span class="search-dropdown-body">
              <span class="search-dropdown-title">${D(E.title)}</span>
              <span class="search-dropdown-meta">${ee}<span>${D(E.date_short)}</span></span>
            </span>
          </a>`}).join(""),k=`<a class="search-dropdown-footer" href="${v}?s=${encodeURIComponent(r)}&post_type=fb_post" tabindex="-1">View all results →</a>`;return w+k}async function y(n,r,v){a&&a.abort(),a=new AbortController;const w=r===c;w?f(r,'<div class="search-dropdown-loading">Searching…</div>'):p('<div class="search-dropdown-loading">Searching…</div>');try{const k=await fetch(`/wp-json/avscanner/v1/posts?search=${encodeURIComponent(n)}&per_page=5`,{signal:a.signal});if(!k.ok)throw new Error(k.statusText);const E=await k.json(),T=x(E,n,v);w?f(r,T):p(T),i=-1}catch(k){if(k.name==="AbortError")return;M("inline-search",k),w?f(r,""):S()}}if(t.addEventListener("input",()=>{clearTimeout(l);const n=t.value.trim();if(n.length<2){S();return}const r=t.closest("form").action;l=setTimeout(()=>y(n,e,r),300)}),t.addEventListener("keydown",n=>{if(e.hidden)return;if(n.key==="Tab"){S();return}const r=q(e);r.length&&(n.key==="ArrowDown"?(n.preventDefault(),g(e,i<r.length-1?i+1:0)):n.key==="ArrowUp"?(n.preventDefault(),g(e,i>0?i-1:r.length-1)):n.key==="Enter"?i>=0&&r[i]&&(n.preventDefault(),r[i].click()):n.key==="Escape"&&(n.preventDefault(),S()))}),document.addEventListener("click",n=>{n.target.closest(".header-search-wrap")||S()}),t.addEventListener("focus",()=>{t.value.trim().length>=2&&e.innerHTML&&e.hidden&&(e.hidden=!1,t.setAttribute("aria-expanded","true"))}),!s||!o||!c||!h||!u)return;let I=0;function $(){I=window.scrollY,s.hidden=!1,document.body.classList.add("search-open"),document.body.style.top=`-${I}px`,o.focus();const n=o.value.trim();if(n.length>=2){const r=o.closest("form").action;y(n,c,r)}s.addEventListener("keydown",P)}function b(){s.hidden=!0,document.body.classList.remove("search-open"),document.body.style.top="",window.scrollTo(0,I),f(c,""),i=-1,s.removeEventListener("keydown",P),u.focus()}function P(n){if(n.key!=="Tab")return;const r=s.querySelectorAll('button, [href], input, [tabindex]:not([tabindex="-1"])');if(!r.length)return;const v=r[0],w=r[r.length-1];n.shiftKey?document.activeElement===v&&(n.preventDefault(),w.focus()):document.activeElement===w&&(n.preventDefault(),v.focus())}u.addEventListener("click",$),h.addEventListener("click",b),c.addEventListener("touchstart",()=>o.blur(),{passive:!0}),o.addEventListener("input",()=>{clearTimeout(l);const n=o.value.trim();if(n.length<2){f(c,"");return}const r=o.closest("form").action;l=setTimeout(()=>y(n,c,r),300)}),o.addEventListener("keydown",n=>{const r=q(c);if(n.key==="Escape"){n.preventDefault(),b();return}r.length&&(n.key==="ArrowDown"?(n.preventDefault(),g(c,i<r.length-1?i+1:0)):n.key==="ArrowUp"?(n.preventDefault(),g(c,i>0?i-1:r.length-1)):n.key==="Enter"&&i>=0&&r[i]&&(n.preventDefault(),r[i].click()))}),c.addEventListener("click",n=>{n.target.closest(".search-dropdown-item")&&b()}),document.addEventListener("keydown",n=>{n.key==="Escape"&&!s.hidden&&b()})}function Q(){const t="avs_scroll_pos",e=document.querySelector("[data-infinite-scroll]");if(e){e.addEventListener("click",o=>{o.target.closest("a")&&sessionStorage.setItem(t,JSON.stringify({scrollY:window.scrollY}))});const s=sessionStorage.getItem(t);if(s){sessionStorage.removeItem(t);try{const{scrollY:o}=JSON.parse(s);o&&requestAnimationFrame(()=>window.scrollTo(0,o))}catch{}}}}function Z(){const t=!!navigator.share;document.querySelectorAll(".share-btn-native").forEach(e=>{var s;t&&(e.hidden=!1,(s=e.nextElementSibling)==null||s.classList.add("share-buttons-hidden"),e.addEventListener("click",async()=>{try{await navigator.share({title:e.dataset.shareTitle,url:e.dataset.shareUrl})}catch{}}))}),document.querySelectorAll(".copy-link-btn").forEach(e=>{e.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(e.dataset.url||location.href),e.classList.add("is-copied"),setTimeout(()=>e.classList.remove("is-copied"),2e3)}catch{}})})}function N(){const t=document.getElementById("codes-search-input");if(!t)return;const e=document.querySelectorAll(".codes-section"),s=document.querySelectorAll(".codes-row"),o=document.getElementById("codes-match-count"),c=document.getElementById("codes-empty"),h=document.querySelectorAll(".codes-nav-tab");t.addEventListener("input",()=>{const u=t.value.trim().toLowerCase();if(!u){s.forEach(a=>a.hidden=!1),e.forEach(a=>a.classList.remove("is-hidden")),o&&(o.hidden=!0),c&&(c.hidden=!0);return}let l=0;s.forEach(a=>{const i=a.dataset.code||"",f=a.dataset.desc||"",p=i.includes(u)||f.includes(u);a.hidden=!p,p&&l++}),e.forEach(a=>{const i=a.querySelectorAll(".codes-row:not([hidden])");a.classList.toggle("is-hidden",i.length===0)}),o&&(o.textContent=`${l} result${l!==1?"s":""}`,o.hidden=!1),c&&(c.hidden=l>0)}),h.forEach(u=>{u.addEventListener("click",()=>{t.value="",t.dispatchEvent(new Event("input")),h.forEach(l=>l.classList.remove("is-active")),u.classList.add("is-active")})})}function _(){window.addEventListener("scroll",H,{passive:!0}),m==null||m.addEventListener("click",j),d==null||d.querySelectorAll(".nav-link").forEach(t=>{t.addEventListener("click",C)}),document.addEventListener("keydown",t=>{t.key==="Escape"&&C()}),H(),K(),Y||(F(),U(),V()),X(),Q(),W(),B(),J(),z(),Z(),N()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",_):_()})();
