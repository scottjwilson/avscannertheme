(function(){function M(e,t){console.error(`[AVScanner] ${e}:`,t)}window.addEventListener("unhandledrejection",e=>{M("unhandled-promise",e.reason)});const P=window.matchMedia("(prefers-reduced-motion: reduce)").matches,v=document.querySelector(".site-header"),q=document.querySelector(".category-nav");function H(){window.scrollY>50?(v==null||v.classList.add("is-scrolled"),q==null||q.classList.add("is-scrolled")):(v==null||v.classList.remove("is-scrolled"),q==null||q.classList.remove("is-scrolled"))}const m=document.querySelector(".menu-toggle"),u=document.querySelector(".nav-mobile");function B(){const e=(m==null?void 0:m.getAttribute("aria-expanded"))==="true";m==null||m.setAttribute("aria-expanded",!e),u==null||u.classList.toggle("is-open"),u==null||u.setAttribute("aria-hidden",e),document.body.classList.toggle("menu-open")}function T(){m==null||m.setAttribute("aria-expanded","false"),u==null||u.classList.remove("is-open"),u==null||u.setAttribute("aria-hidden","true"),document.body.classList.remove("menu-open")}function Y(){const e=document.querySelectorAll(".reveal");if(!e.length)return;const t={root:null,rootMargin:"0px 0px -10% 0px",threshold:.1},r=new IntersectionObserver(s=>{s.forEach(a=>{a.isIntersecting&&a.target.classList.add("is-visible")})},t);e.forEach(s=>{r.observe(s)})}function j(){const e=document.querySelectorAll(".stagger-children");if(!e.length)return;const t={root:null,rootMargin:"0px 0px -10% 0px",threshold:.1},r=new IntersectionObserver(s=>{s.forEach(a=>{a.isIntersecting&&a.target.classList.add("is-visible")})},t);e.forEach(s=>{r.observe(s)})}function F(){document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){const r=this.getAttribute("href");if(r==="#")return;const s=document.querySelector(r);if(s){t.preventDefault();const a=(v==null?void 0:v.offsetHeight)||0,l=s.getBoundingClientRect().top+window.pageYOffset-a-20;window.scrollTo({top:l,behavior:"smooth"}),T()}})})}function O(){document.querySelectorAll(".card-image img, .single-image img").forEach(t=>{t.complete&&t.naturalHeight>0?t.classList.add("is-loaded"):(t.addEventListener("load",()=>t.classList.add("is-loaded"),{once:!0}),t.addEventListener("error",()=>t.classList.add("is-loaded"),{once:!0}))})}function U(){const e=document.querySelectorAll("[data-year]"),t=new Date().getFullYear();e.forEach(r=>{r.textContent=t})}function V(){const e=document.querySelector(".theme-toggle");if(!e)return;const t=localStorage.getItem("cvw-theme");(t==="light"||t==="dark")&&(document.documentElement.dataset.theme=t),e.addEventListener("click",()=>{const s=document.documentElement.dataset.theme==="light"?"dark":"light";document.documentElement.dataset.theme=s,localStorage.setItem("cvw-theme",s)})}function z(){const e=document.querySelector(".back-to-top");e&&(window.addEventListener("scroll",()=>{window.scrollY>400?(e.hidden=!1,requestAnimationFrame(()=>e.classList.add("is-visible"))):(e.classList.remove("is-visible"),e.addEventListener("transitionend",()=>{e.classList.contains("is-visible")||(e.hidden=!0)},{once:!0}))},{passive:!0}),e.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})}))}function J(){const e=document.querySelectorAll(".grid.stagger-children"),t=document.getElementById("card-skeleton");!e.length||!t||e.forEach(r=>{const s=r.querySelectorAll(".card");if(!s.length)return;const a=Math.min(s.length,6),l=document.createElement("div");l.className="skeleton-grid",l.classList.add("grid","grid-3");for(let c=0;c<a;c++)l.appendChild(t.content.cloneNode(!0));r.parentNode.insertBefore(l,r),r.style.display="none";const h=r.querySelectorAll(".card-image img");if(!h.length){_(l,r);return}let f=0;const d=h.length;function o(){f++,f>=d&&_(l,r)}h.forEach(c=>{c.complete&&c.naturalHeight>0?o():(c.addEventListener("load",o,{once:!0}),c.addEventListener("error",o,{once:!0}))}),setTimeout(()=>_(l,r),5e3)})}function _(e,t){e.parentNode&&(e.classList.add("skeleton-fade-out"),t.style.display="",e.addEventListener("transitionend",()=>{e.remove()},{once:!0}),setTimeout(()=>e.remove(),400))}function g(e){const t=document.createElement("div");return t.textContent=e||"",t.innerHTML}function G(e){const t=document.getElementById("card-skeleton");return t?Array.from({length:e},()=>{const r=t.content.cloneNode(!0).firstElementChild;return r.classList.add("infinite-scroll-skeleton"),r}):[]}function K(e){var h,f;const t=document.createElement("article"),r=(h=e.categories_detail)==null?void 0:h.some(d=>d.slug==="advertisement");t.className="card card-hover"+(r?" card-sponsored":"");let s="";if(e.thumbnail_url||e.thumbnail_html){const d=e.video_url?" has-video":"",o=e.video_url?'<span class="card-play-icon" aria-hidden="true"><svg width="48" height="48" viewBox="0 0 48 48" fill="none"><circle cx="24" cy="24" r="24" fill="rgba(0,0,0,0.6)"/><path d="M19 15l14 9-14 9V15z" fill="white"/></svg></span>':"",c=e.thumbnail_html?e.thumbnail_html:`<img src="${e.thumbnail_url}" alt="${g(e.title)}" loading="lazy" decoding="async">`;s=`<a href="${e.permalink}" class="card-image-link${d}"><div class="card-image">${c}${o}</div></a>`}let a="";(f=e.categories_detail)!=null&&f.length&&(r?a='<div class="card-badges"><span class="badge badge-sponsored">Sponsored</span></div>':a='<div class="card-badges">'+e.categories_detail.map(d=>`<a href="${d.link}" class="badge badge-${d.slug}">${g(d.name)}</a>`).join("")+"</div>");let l="";if(e.shared_url)try{const d=new URL(e.shared_url).hostname;l=`<span class="card-source">via ${g(d)}</span>`}catch{}return t.innerHTML=`
        ${s}
        <span class="card-date">${g(e.date_short)} at ${g(e.time)}</span>
        ${a}
        ${l}
        <h3 class="card-title"><a href="${e.permalink}">${g(e.title)}</a></h3>
        <p class="card-text">${g(e.excerpt_short)}</p>
        <a href="${e.permalink}" class="card-link">Read more <svg width="16" height="16" viewBox="0 0 20 20" fill="none"><path d="M4.167 10h11.666M10 4.167L15.833 10 10 15.833" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></a>
    `,t}function X(){const e=document.querySelectorAll("[data-infinite-scroll]");e.length&&e.forEach(t=>{const r=parseInt(t.dataset.perPage)||12,s=parseInt(t.dataset.totalPages)||1,a=t.dataset.category||"";let l=parseInt(t.dataset.currentPage)||1,h=!1;const f=t.nextElementSibling;if(!f)return;const d=f.querySelector(".infinite-scroll-sentinel"),o=f.querySelector(".infinite-scroll-load-more"),c=f.querySelector(".infinite-scroll-status");if(l>=s)return;const $=new IntersectionObserver(y=>{y[0].isIntersecting&&!h&&S()},{rootMargin:"200px"});$.observe(d),o.hidden=!1,o.addEventListener("click",S);async function S(){if(h||l>=s)return;h=!0,o.hidden=!0,c.hidden=!1,c.textContent="Loading more posts…";const y=G(3);t.append(...y);try{const w=new URLSearchParams({page:l+1,per_page:r});a&&w.set("category",a);const L=await fetch(`/wp-json/avscanner/v1/posts?${w}`);if(!L.ok)throw new Error(L.statusText);const x=await L.json(),C=parseInt(L.headers.get("X-WP-TotalPages"))||s;y.forEach(E=>E.remove()),x.forEach(E=>{const n=K(E);t.appendChild(n)}),l++,t.dataset.currentPage=l,l>=C?($.disconnect(),o.hidden=!0,c.hidden=!1,c.textContent="All posts loaded"):(o.hidden=!1,c.hidden=!0),O()}catch(w){M("infinite-scroll",w),y.forEach(L=>L.remove()),o.hidden=!1,c.hidden=!1,c.textContent="Failed to load — try again"}h=!1}})}function Q(){const e=document.getElementById("header-search-input"),t=document.getElementById("search-dropdown");if(!e||!t)return;const r=document.querySelector(".search-overlay"),s=r==null?void 0:r.querySelector(".search-overlay-input"),a=r==null?void 0:r.querySelector(".search-overlay-results"),l=r==null?void 0:r.querySelector(".search-overlay-back"),h=document.querySelector(".search-trigger");window.matchMedia("(max-width: 639px)");let f=null,d=null,o=-1;function c(n,i){n.innerHTML=i}function $(n){t.innerHTML=n,t.hidden=!1,e.setAttribute("aria-expanded","true")}function S(){t.hidden=!0,t.innerHTML="",e.setAttribute("aria-expanded","false"),o=-1}function y(n){return n.querySelectorAll(".search-dropdown-item")}function w(n,i){const b=y(n);b.forEach(A=>A.classList.remove("is-active")),o=i,b[o]&&(b[o].classList.add("is-active"),b[o].scrollIntoView({block:"nearest"}))}function L(n,i,b){if(!n.length)return'<div class="search-dropdown-empty">No results found</div>';const A=n.map(p=>{var R;const I=p.thumbnail_url?`<img class="search-dropdown-thumb" src="${p.thumbnail_url}" alt="" loading="lazy" decoding="async">`:"",N=(R=p.categories_detail)!=null&&R.length?`<span class="badge badge-${p.categories_detail[0].slug}">${g(p.categories_detail[0].name)}</span>`:"";return`<a class="search-dropdown-item" href="${p.permalink}" role="option">
            ${I}
            <span class="search-dropdown-body">
              <span class="search-dropdown-title">${g(p.title)}</span>
              <span class="search-dropdown-meta">${N}<span>${g(p.date_short)}</span></span>
            </span>
          </a>`}).join(""),k=`<a class="search-dropdown-footer" href="${b}?s=${encodeURIComponent(i)}&post_type=fb_post">View all results →</a>`;return A+k}async function x(n,i,b){d&&d.abort(),d=new AbortController;const A=i===a;A?c(i,'<div class="search-dropdown-loading">Searching…</div>'):$('<div class="search-dropdown-loading">Searching…</div>');try{const k=await fetch(`/wp-json/avscanner/v1/posts?search=${encodeURIComponent(n)}&per_page=5`,{signal:d.signal});if(!k.ok)throw new Error(k.statusText);const p=await k.json(),I=L(p,n,b);A?c(i,I):$(I),o=-1}catch(k){if(k.name==="AbortError")return;M("inline-search",k),A?c(i,""):S()}}if(e.addEventListener("input",()=>{clearTimeout(f);const n=e.value.trim();if(n.length<2){S();return}const i=e.closest("form").action;f=setTimeout(()=>x(n,t,i),300)}),e.addEventListener("keydown",n=>{if(t.hidden)return;const i=y(t);i.length&&(n.key==="ArrowDown"?(n.preventDefault(),w(t,o<i.length-1?o+1:0)):n.key==="ArrowUp"?(n.preventDefault(),w(t,o>0?o-1:i.length-1)):n.key==="Enter"?o>=0&&i[o]&&(n.preventDefault(),i[o].click()):n.key==="Escape"&&(n.preventDefault(),S()))}),document.addEventListener("click",n=>{n.target.closest(".header-search-wrap")||S()}),e.addEventListener("focus",()=>{e.value.trim().length>=2&&t.innerHTML&&t.hidden&&(t.hidden=!1,e.setAttribute("aria-expanded","true"))}),!r||!s||!a||!l||!h)return;function C(){r.hidden=!1,document.body.classList.add("search-open"),requestAnimationFrame(()=>s.focus());const n=s.value.trim();if(n.length>=2){const i=s.closest("form").action;x(n,a,i)}}function E(){r.hidden=!0,document.body.classList.remove("search-open"),c(a,""),o=-1}h.addEventListener("click",C),l.addEventListener("click",E),s.addEventListener("input",()=>{clearTimeout(f);const n=s.value.trim();if(n.length<2){c(a,"");return}const i=s.closest("form").action;f=setTimeout(()=>x(n,a,i),300)}),s.addEventListener("keydown",n=>{const i=y(a);if(n.key==="Escape"){n.preventDefault(),E();return}i.length&&(n.key==="ArrowDown"?(n.preventDefault(),w(a,o<i.length-1?o+1:0)):n.key==="ArrowUp"?(n.preventDefault(),w(a,o>0?o-1:i.length-1)):n.key==="Enter"&&o>=0&&i[o]&&(n.preventDefault(),i[o].click()))}),a.addEventListener("click",n=>{n.target.closest(".search-dropdown-item")&&E()}),document.addEventListener("keydown",n=>{n.key==="Escape"&&!r.hidden&&E()})}function Z(){const e="avs_scroll_pos",t=document.querySelector("[data-infinite-scroll]");if(t){t.addEventListener("click",s=>{s.target.closest("a")&&sessionStorage.setItem(e,JSON.stringify({scrollY:window.scrollY}))});const r=sessionStorage.getItem(e);if(r){sessionStorage.removeItem(e);try{const{scrollY:s}=JSON.parse(r);s&&requestAnimationFrame(()=>window.scrollTo(0,s))}catch{}}}}function D(){window.addEventListener("scroll",H,{passive:!0}),m==null||m.addEventListener("click",B),u==null||u.querySelectorAll(".nav-link").forEach(e=>{e.addEventListener("click",T)}),document.addEventListener("keydown",e=>{e.key==="Escape"&&T()}),H(),V(),P||(J(),Y(),j(),F()),Q(),Z(),X(),O(),U(),z()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",D):D()})();
